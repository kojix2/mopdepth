{"repository_name":"mopdepth","body":"# mopdepth\n\n[![build](https://github.com/kojix2/mopdepth/actions/workflows/build.yml/badge.svg)](https://github.com/kojix2/mopdepth/actions/workflows/build.yml)\n[![Lines of Code](https://img.shields.io/endpoint?url=https%3A%2F%2Ftokei.kojix2.net%2Fbadge%2Fgithub%2Fkojix2%2Fmopdepth%2Flines)](https://tokei.kojix2.net/github/kojix2/mopdepth)\n![Static Badge](https://img.shields.io/badge/PURE-VIBE_CODING-magenta)\n\nA fast BAM/CRAM depth calculation tool written in Crystal, inspired by [mosdepth](https://github.com/brentp/mosdepth).\n\n**This is an experiment to see if well-known tools can be ported to Crystal using “vibe coding”.**\n\n## Features\n\n- Fast depth calculation for BAM/CRAM files\n- Multiple processing modes (fast mode, fragment mode, CIGAR-based)\n- Per-base and region-based depth analysis\n- BED file support for custom regions\n- Window-based analysis\n- Comprehensive filtering options (MAPQ, fragment length, flags)\n\n## Installation\n\n### Prerequisites\n\n- Crystal\n- hts-lib (for BAM/CRAM support)\n\n### Build from source\n\n```bash\ngit clone https://github.com/kojix2/mopdepth\ncd mopdepth\nshards install\nshares build --release\n```\n\n## Usage\n\n```bash\n./mopdepth [options] <prefix> <BAM-or-CRAM>\n```\n\n### Basic example\n\n```bash\n./mopdepth output sample.bam\n```\n\n### Options\n\n- `-t, --threads THREADS`: BAM decompression threads\n- `-c, --chrom CHROM`: Restrict to chromosome\n- `-b, --by BY`: BED file or numeric window size\n- `-n, --no-per-base`: Skip per-base output\n- `-Q, --mapq MAPQ`: MAPQ threshold\n- `-l, --min-frag-len MIN`: Minimum fragment length\n- `-u, --max-frag-len MAX`: Maximum fragment length\n- `-x, --fast-mode`: Fast mode (read start/end positions only)\n- `-a, --fragment-mode`: Count full fragment (proper pairs only)\n- `-m, --use-median`: Use median for region stats instead of mean\n- `-M, --mos`: Use mosdepth-compatible filenames (mosdepth.*); default is depth.*\n- `-v, --version`: Show version\n- `-h, --help`: Show help message\n\n### Processing modes\n\n- **Default mode**: CIGAR-based depth calculation (most accurate)\n- **Fast mode** (`-x`): Uses read start/end positions (faster but less accurate)\n- **Fragment mode** (`-a`): Counts full fragments for paired-end reads\n\n**Note**: Fast mode and fragment mode cannot be used together.\n\n### Output files\n\n- Summary: `<prefix>.(mopdepth|mosdepth).summary.txt`\n- Per-base: `<prefix>.per-base.bed` (unless `-n`)\n- Global dist: `<prefix>.(mopdepth|mosdepth).global.dist.txt`\n- Regions: `<prefix>.regions.bed` (when `--by`)\n- Region dist: `<prefix>.(mopdepth|mosdepth).region.dist.txt` (when `--by`)\n\nBy default, files are named with the `mopdepth.*` label. Use `-M/--mos` to switch to `mosdepth.*`.\n\n### Summary file format\n\nThe summary file contains the following columns:\n\n- `chrom`: Chromosome name\n- `length`: Chromosome length\n- `sum_depth`: Total depth (sum of all depths)\n- `mean`: Mean depth\n- `min`: Minimum depth\n- `max`: Maximum depth\n\n## Examples\n\n### Basic depth calculation\n\n```bash\n./mopdepth output sample.bam\n```\n\n### With BED regions\n\n```bash\n./mopdepth -b regions.bed output sample.bam\n```\n\n### Window-based analysis (1kb windows)\n\n```bash\n./mopdepth -b 1000 output sample.bam\n```\n\n### Fast mode with MAPQ filtering\n\n```bash\n./mopdepth -x -Q 20 output sample.bam\n```\n\n### Fragment mode for paired-end data\n\n```bash\n./mopdepth -a -l 100 -u 1000 output sample.bam\n```\n\n## License\n\nMIT License\n","program":{"html_id":"mopdepth/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"locations":[],"repository_name":"mopdepth","program":true,"enum":false,"alias":false,"const":false,"types":[{"html_id":"mopdepth/Depth","path":"Depth.html","kind":"module","full_name":"Depth","name":"Depth","abstract":false,"locations":[{"filename":"src/depth.cr","line_number":7,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth.cr#L7"},{"filename":"src/depth/config.cr","line_number":5,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L5"},{"filename":"src/depth/errors.cr","line_number":1,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/errors.cr#L1"},{"filename":"src/depth/runner.cr","line_number":14,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/runner.cr#L14"},{"filename":"src/depth/stats/quantize.cr","line_number":1,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/quantize.cr#L1"},{"filename":"src/depth/version.cr","line_number":1,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/version.cr#L1"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"VERSION","name":"VERSION","value":"{{ (`shards version /home/runner/work/mopdepth/mopdepth/src/depth`).chomp.stringify }}"}],"types":[{"html_id":"mopdepth/Depth/BamIndexError","path":"Depth/BamIndexError.html","kind":"class","full_name":"Depth::BamIndexError","name":"BamIndexError","abstract":false,"superclass":{"html_id":"mopdepth/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},"ancestors":[{"html_id":"mopdepth/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},{"html_id":"mopdepth/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mopdepth/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/errors.cr","line_number":12,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/errors.cr#L12"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth","kind":"module","full_name":"Depth","name":"Depth"}},{"html_id":"mopdepth/Depth/CLI","path":"Depth/CLI.html","kind":"class","full_name":"Depth::CLI","name":"CLI","abstract":false,"superclass":{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mopdepth/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth.cr","line_number":8,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth.cr#L8"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth","kind":"module","full_name":"Depth","name":"Depth"},"class_methods":[{"html_id":"run(args=ARGV)-class-method","name":"run","abstract":false,"args":[{"name":"args","default_value":"ARGV","external_name":"args","restriction":""}],"args_string":"(args = ARGV)","args_html":"(args = <span class=\"t\">ARGV</span>)","location":{"filename":"src/depth.cr","line_number":9,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth.cr#L9"},"def":{"name":"run","args":[{"name":"args","default_value":"ARGV","external_name":"args","restriction":""}],"visibility":"Public","body":"config = Config.new\nconfig.prefix = \"out\"\n\nOptionParser.parse(args) do |psr|\n  psr.banner = \"Usage: mopdepth [options] <prefix> <BAM-or-CRAM>\"\n\n  psr.on(\"-t\", \"--threads THREADS\", \"BAM decompression threads\") do |v| config.threads = v.to_i end\n  psr.on(\"-c\", \"--chrom CHROM\", \"Restrict to chromosome\") do |v| config.chrom = v end\n  psr.on(\"-b\", \"--by BY\", \"BED file or numeric window size\") do |v| config.by = v end\n  psr.on(\"-n\", \"--no-per-base\", \"Skip per-base output\") do config.no_per_base = true end\n  psr.on(\"-Q\", \"--mapq MAPQ\", \"MAPQ threshold\") do |v| config.mapq = v.to_i end\n  psr.on(\"-l\", \"--min-frag-len MIN\", \"Minimum fragment length\") do |v| config.min_frag_len = v.to_i end\n  psr.on(\"-u\", \"--max-frag-len MAX\", \"Maximum fragment length\") do |v| config.max_frag_len = v.to_i end\n  psr.on(\"-x\", \"--fast-mode\", \"Fast mode\") do config.fast_mode = true end\n  psr.on(\"-a\", \"--fragment-mode\", \"Count full fragment (proper pairs only)\") do config.fragment_mode = true end\n  psr.on(\"-m\", \"--use-median\", \"Use median for region stats instead of mean\") do config.use_median = true end\n  psr.on(\"-q\", \"--quantize QUANTIZE\", \"Write quantized output (e.g., 0:1:4:)\") do |v| config.quantize = v end\n  psr.on(\"-T\", \"--thresholds THRESHOLDS\", \"Comma-separated thresholds for region coverage\") do |v| config.thresholds_str = v end\n  psr.on(\"-F\", \"--flag FLAG\", \"Exclude reads with FLAG bits set\") do |v| config.exclude_flag = v.to_u16 end\n  psr.on(\"-i\", \"--include-flag FLAG\", \"Include only reads with FLAG bits set\") do |v| config.include_flag = v.to_u16 end\n  psr.on(\"-R\", \"--read-groups GROUPS\", \"Comma-separated read group IDs\") do |v| config.read_groups_str = v end\n  psr.on(\"-v\", \"--version\", \"Show version\") do   puts(Depth::VERSION)\n  exit(0)\n end\n  psr.on(\"-M\", \"--mos\", \"Use mosdepth-compatible filenames (mosdepth.*)\") do config.mos_style = true end\n  psr.on(\"-h\", \"--help\", \"Show this message\") do   puts(psr)\n  exit(0)\n end\n\n  psr.invalid_option do |opt|\n    STDERR.puts(\"Error: unknown option: #{opt}\")\n    STDERR.puts(\"Use --help for usage information\")\n    exit(1)\n  end\nend\n\nif ARGV.size < 2\n  STDERR.puts(\"Error: missing arguments: <prefix> <BAM-or-CRAM>\")\n  STDERR.puts(\"Use --help for usage information\")\n  exit(2)\nend\n\nconfig.prefix = ARGV[0]\nconfig.path = ARGV[1]\n\nbegin\n  runner = Runner.new(config)\n  runner.run\nrescue ex : ConfigError\n  STDERR.puts(\"Config error: #{ex.message}\")\n  STDERR.puts(ex.backtrace.first)\n  exit(1)\nrescue ex : FileNotFoundError\n  STDERR.puts(\"File not found: #{ex.message}\")\n  STDERR.puts(ex.backtrace.first)\n  exit(1)\nrescue ex : BamIndexError\n  STDERR.puts(\"Index error: #{ex.message}\")\n  STDERR.puts(ex.backtrace.first)\n  exit(1)\nrescue ex : Exception\n  STDERR.puts(\"Error: #{ex.message}\")\n  STDERR.puts(ex.backtrace.join(\"\\n\"))\n  exit(1)\nend\n"},"external_var":false}]},{"html_id":"mopdepth/Depth/Config","path":"Depth/Config.html","kind":"class","full_name":"Depth::Config","name":"Config","abstract":false,"superclass":{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mopdepth/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/config.cr","line_number":6,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L6"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth","kind":"module","full_name":"Depth","name":"Depth"},"instance_methods":[{"html_id":"bed_path:String|Nil-instance-method","name":"bed_path","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":70,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L70"},"def":{"name":"bed_path","return_type":"String | ::Nil","visibility":"Public","body":"if has_regions?\nelse\n  return nil\nend\nif by.each_char.all?(&.ascii_number?)\n  return nil\nend\nby\n"},"external_var":false},{"html_id":"by:String-instance-method","name":"by","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":11,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L11"},"def":{"name":"by","return_type":"String","visibility":"Public","body":"@by"},"external_var":false},{"html_id":"by=(by:String)-instance-method","name":"by=","abstract":false,"args":[{"name":"by","external_name":"by","restriction":"String"}],"args_string":"(by : String)","args_html":"(by : String)","location":{"filename":"src/depth/config.cr","line_number":11,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L11"},"def":{"name":"by=","args":[{"name":"by","external_name":"by","restriction":"String"}],"visibility":"Public","body":"@by = by"},"external_var":false},{"html_id":"chrom:String-instance-method","name":"chrom","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":10,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L10"},"def":{"name":"chrom","return_type":"String","visibility":"Public","body":"@chrom"},"external_var":false},{"html_id":"chrom=(chrom:String)-instance-method","name":"chrom=","abstract":false,"args":[{"name":"chrom","external_name":"chrom","restriction":"String"}],"args_string":"(chrom : String)","args_html":"(chrom : String)","location":{"filename":"src/depth/config.cr","line_number":10,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L10"},"def":{"name":"chrom=","args":[{"name":"chrom","external_name":"chrom","restriction":"String"}],"visibility":"Public","body":"@chrom = chrom"},"external_var":false},{"html_id":"exclude_flag:UInt16-instance-method","name":"exclude_flag","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":22,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L22"},"def":{"name":"exclude_flag","return_type":"UInt16","visibility":"Public","body":"@exclude_flag"},"external_var":false},{"html_id":"exclude_flag=(exclude_flag:UInt16)-instance-method","name":"exclude_flag=","abstract":false,"args":[{"name":"exclude_flag","external_name":"exclude_flag","restriction":"UInt16"}],"args_string":"(exclude_flag : UInt16)","args_html":"(exclude_flag : UInt16)","location":{"filename":"src/depth/config.cr","line_number":22,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L22"},"def":{"name":"exclude_flag=","args":[{"name":"exclude_flag","external_name":"exclude_flag","restriction":"UInt16"}],"visibility":"Public","body":"@exclude_flag = exclude_flag"},"external_var":false},{"html_id":"fast_mode=(fast_mode:Bool)-instance-method","name":"fast_mode=","abstract":false,"args":[{"name":"fast_mode","external_name":"fast_mode","restriction":"Bool"}],"args_string":"(fast_mode : Bool)","args_html":"(fast_mode : Bool)","location":{"filename":"src/depth/config.cr","line_number":16,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L16"},"def":{"name":"fast_mode=","args":[{"name":"fast_mode","external_name":"fast_mode","restriction":"Bool"}],"visibility":"Public","body":"@fast_mode = fast_mode"},"external_var":false},{"html_id":"fast_mode?:Bool-instance-method","name":"fast_mode?","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":16,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L16"},"def":{"name":"fast_mode?","return_type":"Bool","visibility":"Public","body":"@fast_mode"},"external_var":false},{"html_id":"fragment_mode=(fragment_mode:Bool)-instance-method","name":"fragment_mode=","abstract":false,"args":[{"name":"fragment_mode","external_name":"fragment_mode","restriction":"Bool"}],"args_string":"(fragment_mode : Bool)","args_html":"(fragment_mode : Bool)","location":{"filename":"src/depth/config.cr","line_number":17,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L17"},"def":{"name":"fragment_mode=","args":[{"name":"fragment_mode","external_name":"fragment_mode","restriction":"Bool"}],"visibility":"Public","body":"@fragment_mode = fragment_mode"},"external_var":false},{"html_id":"fragment_mode?:Bool-instance-method","name":"fragment_mode?","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":17,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L17"},"def":{"name":"fragment_mode?","return_type":"Bool","visibility":"Public","body":"@fragment_mode"},"external_var":false},{"html_id":"has_quantize?:Bool-instance-method","name":"has_quantize?","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":76,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L76"},"def":{"name":"has_quantize?","return_type":"Bool","visibility":"Public","body":"!quantize.empty? && (quantize != \"nil\")"},"external_var":false},{"html_id":"has_regions?:Bool-instance-method","name":"has_regions?","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":60,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L60"},"def":{"name":"has_regions?","return_type":"Bool","visibility":"Public","body":"!by.empty?"},"external_var":false},{"html_id":"has_thresholds?:Bool-instance-method","name":"has_thresholds?","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":85,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L85"},"def":{"name":"has_thresholds?","return_type":"Bool","visibility":"Public","body":"!thresholds_str.empty? && (thresholds_str != \"nil\")"},"external_var":false},{"html_id":"include_flag:UInt16-instance-method","name":"include_flag","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":23,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L23"},"def":{"name":"include_flag","return_type":"UInt16","visibility":"Public","body":"@include_flag"},"external_var":false},{"html_id":"include_flag=(include_flag:UInt16)-instance-method","name":"include_flag=","abstract":false,"args":[{"name":"include_flag","external_name":"include_flag","restriction":"UInt16"}],"args_string":"(include_flag : UInt16)","args_html":"(include_flag : UInt16)","location":{"filename":"src/depth/config.cr","line_number":23,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L23"},"def":{"name":"include_flag=","args":[{"name":"include_flag","external_name":"include_flag","restriction":"UInt16"}],"visibility":"Public","body":"@include_flag = include_flag"},"external_var":false},{"html_id":"mapq:Int32-instance-method","name":"mapq","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":13,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L13"},"def":{"name":"mapq","return_type":"Int32","visibility":"Public","body":"@mapq"},"external_var":false},{"html_id":"mapq=(mapq:Int32)-instance-method","name":"mapq=","abstract":false,"args":[{"name":"mapq","external_name":"mapq","restriction":"Int32"}],"args_string":"(mapq : Int32)","args_html":"(mapq : Int32)","location":{"filename":"src/depth/config.cr","line_number":13,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L13"},"def":{"name":"mapq=","args":[{"name":"mapq","external_name":"mapq","restriction":"Int32"}],"visibility":"Public","body":"@mapq = mapq"},"external_var":false},{"html_id":"max_frag_len:Int32-instance-method","name":"max_frag_len","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":15,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L15"},"def":{"name":"max_frag_len","return_type":"Int32","visibility":"Public","body":"@max_frag_len"},"external_var":false},{"html_id":"max_frag_len=(max_frag_len:Int32)-instance-method","name":"max_frag_len=","abstract":false,"args":[{"name":"max_frag_len","external_name":"max_frag_len","restriction":"Int32"}],"args_string":"(max_frag_len : Int32)","args_html":"(max_frag_len : Int32)","location":{"filename":"src/depth/config.cr","line_number":15,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L15"},"def":{"name":"max_frag_len=","args":[{"name":"max_frag_len","external_name":"max_frag_len","restriction":"Int32"}],"visibility":"Public","body":"@max_frag_len = max_frag_len"},"external_var":false},{"html_id":"min_frag_len:Int32-instance-method","name":"min_frag_len","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":14,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L14"},"def":{"name":"min_frag_len","return_type":"Int32","visibility":"Public","body":"@min_frag_len"},"external_var":false},{"html_id":"min_frag_len=(min_frag_len:Int32)-instance-method","name":"min_frag_len=","abstract":false,"args":[{"name":"min_frag_len","external_name":"min_frag_len","restriction":"Int32"}],"args_string":"(min_frag_len : Int32)","args_html":"(min_frag_len : Int32)","location":{"filename":"src/depth/config.cr","line_number":14,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L14"},"def":{"name":"min_frag_len=","args":[{"name":"min_frag_len","external_name":"min_frag_len","restriction":"Int32"}],"visibility":"Public","body":"@min_frag_len = min_frag_len"},"external_var":false},{"html_id":"mos_style=(mos_style:Bool)-instance-method","name":"mos_style=","doc":"When true, use mosdepth-compatible names (mosdepth.*); otherwise mopdepth.*","summary":"<p>When true, use mosdepth-compatible names (mosdepth.<em>); otherwise mopdepth.</em></p>","abstract":false,"args":[{"name":"mos_style","external_name":"mos_style","restriction":"Bool"}],"args_string":"(mos_style : Bool)","args_html":"(mos_style : Bool)","location":{"filename":"src/depth/config.cr","line_number":26,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L26"},"def":{"name":"mos_style=","args":[{"name":"mos_style","external_name":"mos_style","restriction":"Bool"}],"visibility":"Public","body":"@mos_style = mos_style"},"external_var":false},{"html_id":"mos_style?:Bool-instance-method","name":"mos_style?","doc":"When true, use mosdepth-compatible names (mosdepth.*); otherwise mopdepth.*","summary":"<p>When true, use mosdepth-compatible names (mosdepth.<em>); otherwise mopdepth.</em></p>","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":26,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L26"},"def":{"name":"mos_style?","return_type":"Bool","visibility":"Public","body":"@mos_style"},"external_var":false},{"html_id":"no_per_base=(no_per_base:Bool)-instance-method","name":"no_per_base=","abstract":false,"args":[{"name":"no_per_base","external_name":"no_per_base","restriction":"Bool"}],"args_string":"(no_per_base : Bool)","args_html":"(no_per_base : Bool)","location":{"filename":"src/depth/config.cr","line_number":12,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L12"},"def":{"name":"no_per_base=","args":[{"name":"no_per_base","external_name":"no_per_base","restriction":"Bool"}],"visibility":"Public","body":"@no_per_base = no_per_base"},"external_var":false},{"html_id":"no_per_base?:Bool-instance-method","name":"no_per_base?","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":12,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L12"},"def":{"name":"no_per_base?","return_type":"Bool","visibility":"Public","body":"@no_per_base"},"external_var":false},{"html_id":"path:String-instance-method","name":"path","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":8,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L8"},"def":{"name":"path","return_type":"String","visibility":"Public","body":"@path"},"external_var":false},{"html_id":"path=(path:String)-instance-method","name":"path=","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String)","args_html":"(path : String)","location":{"filename":"src/depth/config.cr","line_number":8,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L8"},"def":{"name":"path=","args":[{"name":"path","external_name":"path","restriction":"String"}],"visibility":"Public","body":"@path = path"},"external_var":false},{"html_id":"prefix:String-instance-method","name":"prefix","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":7,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L7"},"def":{"name":"prefix","return_type":"String","visibility":"Public","body":"@prefix"},"external_var":false},{"html_id":"prefix=(prefix:String)-instance-method","name":"prefix=","abstract":false,"args":[{"name":"prefix","external_name":"prefix","restriction":"String"}],"args_string":"(prefix : String)","args_html":"(prefix : String)","location":{"filename":"src/depth/config.cr","line_number":7,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L7"},"def":{"name":"prefix=","args":[{"name":"prefix","external_name":"prefix","restriction":"String"}],"visibility":"Public","body":"@prefix = prefix"},"external_var":false},{"html_id":"quantize:String-instance-method","name":"quantize","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":21,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L21"},"def":{"name":"quantize","return_type":"String","visibility":"Public","body":"@quantize"},"external_var":false},{"html_id":"quantize=(quantize:String)-instance-method","name":"quantize=","abstract":false,"args":[{"name":"quantize","external_name":"quantize","restriction":"String"}],"args_string":"(quantize : String)","args_html":"(quantize : String)","location":{"filename":"src/depth/config.cr","line_number":21,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L21"},"def":{"name":"quantize=","args":[{"name":"quantize","external_name":"quantize","restriction":"String"}],"visibility":"Public","body":"@quantize = quantize"},"external_var":false},{"html_id":"quantize_args:Array(Int32)-instance-method","name":"quantize_args","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":80,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L80"},"def":{"name":"quantize_args","return_type":"Array(Int32)","visibility":"Public","body":"if has_quantize?\nelse\n  return [] of Int32\nend\nStats::Quantize.get_quantize_args(quantize)\n"},"external_var":false},{"html_id":"read_groups_str:String-instance-method","name":"read_groups_str","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":24,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L24"},"def":{"name":"read_groups_str","return_type":"String","visibility":"Public","body":"@read_groups_str"},"external_var":false},{"html_id":"read_groups_str=(read_groups_str:String)-instance-method","name":"read_groups_str=","abstract":false,"args":[{"name":"read_groups_str","external_name":"read_groups_str","restriction":"String"}],"args_string":"(read_groups_str : String)","args_html":"(read_groups_str : String)","location":{"filename":"src/depth/config.cr","line_number":24,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L24"},"def":{"name":"read_groups_str=","args":[{"name":"read_groups_str","external_name":"read_groups_str","restriction":"String"}],"visibility":"Public","body":"@read_groups_str = read_groups_str"},"external_var":false},{"html_id":"threads:Int32-instance-method","name":"threads","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":9,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L9"},"def":{"name":"threads","return_type":"Int32","visibility":"Public","body":"@threads"},"external_var":false},{"html_id":"threads=(threads:Int32)-instance-method","name":"threads=","abstract":false,"args":[{"name":"threads","external_name":"threads","restriction":"Int32"}],"args_string":"(threads : Int32)","args_html":"(threads : Int32)","location":{"filename":"src/depth/config.cr","line_number":9,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L9"},"def":{"name":"threads=","args":[{"name":"threads","external_name":"threads","restriction":"Int32"}],"visibility":"Public","body":"@threads = threads"},"external_var":false},{"html_id":"threshold_values:Array(Int32)-instance-method","name":"threshold_values","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":89,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L89"},"def":{"name":"threshold_values","return_type":"Array(Int32)","visibility":"Public","body":"if has_thresholds?\nelse\n  return [] of Int32\nend\nStats.threshold_args(thresholds_str)\n"},"external_var":false},{"html_id":"thresholds:Array(Int32)-instance-method","name":"thresholds","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":19,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L19"},"def":{"name":"thresholds","return_type":"Array(Int32)","visibility":"Public","body":"@thresholds"},"external_var":false},{"html_id":"thresholds=(thresholds:Array(Int32))-instance-method","name":"thresholds=","abstract":false,"args":[{"name":"thresholds","external_name":"thresholds","restriction":"Array(Int32)"}],"args_string":"(thresholds : Array(Int32))","args_html":"(thresholds : Array(Int32))","location":{"filename":"src/depth/config.cr","line_number":19,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L19"},"def":{"name":"thresholds=","args":[{"name":"thresholds","external_name":"thresholds","restriction":"Array(Int32)"}],"visibility":"Public","body":"@thresholds = thresholds"},"external_var":false},{"html_id":"thresholds_str:String-instance-method","name":"thresholds_str","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":20,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L20"},"def":{"name":"thresholds_str","return_type":"String","visibility":"Public","body":"@thresholds_str"},"external_var":false},{"html_id":"thresholds_str=(thresholds_str:String)-instance-method","name":"thresholds_str=","abstract":false,"args":[{"name":"thresholds_str","external_name":"thresholds_str","restriction":"String"}],"args_string":"(thresholds_str : String)","args_html":"(thresholds_str : String)","location":{"filename":"src/depth/config.cr","line_number":20,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L20"},"def":{"name":"thresholds_str=","args":[{"name":"thresholds_str","external_name":"thresholds_str","restriction":"String"}],"visibility":"Public","body":"@thresholds_str = thresholds_str"},"external_var":false},{"html_id":"to_options:Core::Options-instance-method","name":"to_options","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":47,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L47"},"def":{"name":"to_options","return_type":"Core::Options","visibility":"Public","body":"Core::Options.new(mapq: mapq, min_frag_len: min_frag_len, max_frag_len: (max_frag_len < 0 ? Int32::MAX : max_frag_len), exclude_flag: exclude_flag, include_flag: include_flag, fast_mode: fast_mode?, fragment_mode: fragment_mode?, read_groups: parse_read_groups)"},"external_var":false},{"html_id":"use_median=(use_median:Bool)-instance-method","name":"use_median=","abstract":false,"args":[{"name":"use_median","external_name":"use_median","restriction":"Bool"}],"args_string":"(use_median : Bool)","args_html":"(use_median : Bool)","location":{"filename":"src/depth/config.cr","line_number":18,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L18"},"def":{"name":"use_median=","args":[{"name":"use_median","external_name":"use_median","restriction":"Bool"}],"visibility":"Public","body":"@use_median = use_median"},"external_var":false},{"html_id":"use_median?:Bool-instance-method","name":"use_median?","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":18,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L18"},"def":{"name":"use_median?","return_type":"Bool","visibility":"Public","body":"@use_median"},"external_var":false},{"html_id":"validate!-instance-method","name":"validate!","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":28,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L28"},"def":{"name":"validate!","visibility":"Public","body":"if path.empty?\n  raise(ArgumentError.new(\"BAM/CRAM path is required\"))\nend\nif prefix.empty?\n  raise(ArgumentError.new(\"Output prefix is required\"))\nend\nif mapq < 0\n  raise(ArgumentError.new(\"Invalid MAPQ threshold\"))\nend\nif threads < 0\n  raise(ArgumentError.new(\"Invalid thread count\"))\nend\n\nif (min_frag_len >= 0 && max_frag_len >= 0) && min_frag_len > max_frag_len\n  raise(ArgumentError.new(\"min_frag_len cannot be greater than max_frag_len\"))\nend\n\nif fast_mode? && fragment_mode?\n  raise(ArgumentError.new(\"--fast-mode and --fragment-mode cannot be used together\"))\nend\n\nif has_thresholds? && (!has_regions?)\n  raise(ArgumentError.new(\"--thresholds can only be used when --by is specified\"))\nend\n"},"external_var":false},{"html_id":"window_size:Int32-instance-method","name":"window_size","abstract":false,"location":{"filename":"src/depth/config.cr","line_number":64,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/config.cr#L64"},"def":{"name":"window_size","return_type":"Int32","visibility":"Public","body":"if has_regions?\nelse\n  return 0\nend\nif by.each_char.all?(&.ascii_number?)\nelse\n  return 0\nend\nby.to_i\n"},"external_var":false}]},{"html_id":"mopdepth/Depth/ConfigError","path":"Depth/ConfigError.html","kind":"class","full_name":"Depth::ConfigError","name":"ConfigError","abstract":false,"superclass":{"html_id":"mopdepth/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},"ancestors":[{"html_id":"mopdepth/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},{"html_id":"mopdepth/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mopdepth/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/errors.cr","line_number":10,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/errors.cr#L10"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth","kind":"module","full_name":"Depth","name":"Depth"}},{"html_id":"mopdepth/Depth/Core","path":"Depth/Core.html","kind":"module","full_name":"Depth::Core","name":"Core","abstract":false,"locations":[{"filename":"src/depth/core/cigar.cr","line_number":1,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/cigar.cr#L1"},{"filename":"src/depth/core/constants.cr","line_number":1,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/constants.cr#L1"},{"filename":"src/depth/core/coverage.cr","line_number":1,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/coverage.cr#L1"},{"filename":"src/depth/core/coverage_calculator.cr","line_number":7,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/coverage_calculator.cr#L7"},{"filename":"src/depth/core/coverage_result.cr","line_number":1,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/coverage_result.cr#L1"},{"filename":"src/depth/core/coverage_utils.cr","line_number":1,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/coverage_utils.cr#L1"},{"filename":"src/depth/core/options.cr","line_number":1,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/options.cr#L1"},{"filename":"src/depth/core/region.cr","line_number":1,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/region.cr#L1"},{"filename":"src/depth/core/target.cr","line_number":1,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/target.cr#L1"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"MAX_COVERAGE","name":"MAX_COVERAGE","value":"400000","doc":"General constants and type alias","summary":"<p>General constants and type alias</p>"},{"id":"UNKNOWN_CHROM_TID","name":"UNKNOWN_CHROM_TID","value":"-999"}],"namespace":{"html_id":"mopdepth/Depth","kind":"module","full_name":"Depth","name":"Depth"},"types":[{"html_id":"mopdepth/Depth/Core/Cigar","path":"Depth/Core/Cigar.html","kind":"module","full_name":"Depth::Core::Cigar","name":"Cigar","abstract":false,"locations":[{"filename":"src/depth/core/cigar.cr","line_number":2,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/cigar.cr#L2"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"mopdepth/Depth/Core/CoverageCalculator","kind":"class","full_name":"Depth::Core::CoverageCalculator","name":"CoverageCalculator"}],"namespace":{"html_id":"mopdepth/Depth/Core","kind":"module","full_name":"Depth::Core","name":"Core"},"instance_methods":[{"html_id":"cigar_each_segment(cigar,ipos:Int32,&:Tuple(Int32,Int32)->)-instance-method","name":"cigar_each_segment","doc":"Stream segments without building an array","summary":"<p>Stream segments without building an array</p>","abstract":false,"args":[{"name":"cigar","external_name":"cigar","restriction":""},{"name":"ipos","external_name":"ipos","restriction":"Int32"}],"args_string":"(cigar, ipos : Int32, & : Tuple(Int32, Int32) -> )","args_html":"(cigar, ipos : Int32, & : Tuple(Int32, Int32) -> )","location":{"filename":"src/depth/core/cigar.cr","line_number":91,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/cigar.cr#L91"},"def":{"name":"cigar_each_segment","args":[{"name":"cigar","external_name":"cigar","restriction":""},{"name":"ipos","external_name":"ipos","restriction":"Int32"}],"yields":1,"block_arity":1,"block_arg":{"name":"","external_name":"","restriction":"(Tuple(Int32, Int32) ->)"},"visibility":"Public","body":"pos = ipos\nseg_start = -1\nseg_stop = -1\ncigar.each do |op_char, olen|\n  consumes_ref = ['M', 'D', 'N', '=', 'X'].includes?(op_char)\n  if consumes_ref\n  else\n    next\n  end\n  consumes_query = ['M', 'I', 'S', '=', 'X'].includes?(op_char)\n  if consumes_query\n    if pos != seg_stop\n      if seg_start >= 0 && seg_stop >= 0\n        yield({seg_start, seg_stop})\n      end\n      seg_start = pos\n    end\n    seg_stop = pos + olen.to_i32\n  end\n  pos = pos + olen.to_i32\nend\nif seg_start >= 0 && seg_stop >= 0\n  yield({seg_start, seg_stop})\nend\n"},"external_var":false},{"html_id":"cigar_fill_events!(cigar,ipos:Int32,evbuf:Array(Tuple(Int32,Int32))):Nil-instance-method","name":"cigar_fill_events!","doc":"CIGAR → start/end events on reference\nReturns array of {pos, +1/-1}; pos is 0-based ref coordinate\n\nKey points (what contributes to depth):\n- Only operations that consume both reference and query contribute to depth: M, =, X\n- D, N consume reference only (gaps). They do not add to depth; we just advance the ref position (pos)\n- I, S consume query only. They do not advance reference and do not add to depth\n\nImplementation strategy:\n- Operations that don't consume reference are skipped entirely (next unless consumes_ref)\n- Only when an op consumes both reference and query (M/= /X) we emit start(+1)/end(-1) events\n  This ensures only M/= /X spans change coverage when later applied to the diff array\nFill start/end events into a provided buffer to avoid allocations.\nEach event is a tuple: {pos, +1/-1}","summary":"<p>CIGAR → start/end events on reference Returns array of {pos, +1/-1}; pos is 0-based ref coordinate</p>","abstract":false,"args":[{"name":"cigar","external_name":"cigar","restriction":""},{"name":"ipos","external_name":"ipos","restriction":"Int32"},{"name":"evbuf","external_name":"evbuf","restriction":"Array(Tuple(Int32, Int32))"}],"args_string":"(cigar, ipos : Int32, evbuf : Array(Tuple(Int32, Int32))) : Nil","args_html":"(cigar, ipos : Int32, evbuf : Array(Tuple(Int32, Int32))) : Nil","location":{"filename":"src/depth/core/cigar.cr","line_number":24,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/cigar.cr#L24"},"def":{"name":"cigar_fill_events!","args":[{"name":"cigar","external_name":"cigar","restriction":""},{"name":"ipos","external_name":"ipos","restriction":"Int32"},{"name":"evbuf","external_name":"evbuf","restriction":"Array(Tuple(Int32, Int32))"}],"return_type":"Nil","visibility":"Public","body":"pos = ipos\nlast_stop = -1\ncigar.each do |op_char, olen|\n\n  consumes_ref = ['M', 'D', 'N', '=', 'X'].includes?(op_char)\n  if consumes_ref\n  else\n    next\n  end\n\n\n  consumes_query = ['M', 'I', 'S', '=', 'X'].includes?(op_char)\n  if consumes_query\n    if pos != last_stop\n      evbuf << {pos, 1}\n      if last_stop >= 0\n        evbuf << {last_stop, -1}\n      end\n    end\n    last_stop = pos + olen.to_i32\n  end\n\n\n  pos = pos + olen.to_i32\nend\n\nif last_stop >= 0\n  evbuf << {last_stop, -1}\nend\nnil\n"},"external_var":false},{"html_id":"cigar_segments(cigar,ipos:Int32):Array(Tuple(Int32,Int32))-instance-method","name":"cigar_segments","doc":"Build contiguous reference-aligned segments [start, stop) for M/= /X parts.\nThis mirrors cigar_start_end_events but returns merged intervals directly.","summary":"<p>Build contiguous reference-aligned segments [start, stop) for M/= /X parts.</p>","abstract":false,"args":[{"name":"cigar","external_name":"cigar","restriction":""},{"name":"ipos","external_name":"ipos","restriction":"Int32"}],"args_string":"(cigar, ipos : Int32) : Array(Tuple(Int32, Int32))","args_html":"(cigar, ipos : Int32) : Array(Tuple(Int32, Int32))","location":{"filename":"src/depth/core/cigar.cr","line_number":65,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/cigar.cr#L65"},"def":{"name":"cigar_segments","args":[{"name":"cigar","external_name":"cigar","restriction":""},{"name":"ipos","external_name":"ipos","restriction":"Int32"}],"return_type":"Array(Tuple(Int32, Int32))","visibility":"Public","body":"segs = [] of Tuple(Int32, Int32)\npos = ipos\nseg_start = -1\nseg_stop = -1\ncigar.each do |op_char, olen|\n  consumes_ref = ['M', 'D', 'N', '=', 'X'].includes?(op_char)\n  if consumes_ref\n  else\n    next\n  end\n\n  consumes_query = ['M', 'I', 'S', '=', 'X'].includes?(op_char)\n  if consumes_query\n    if pos != seg_stop\n      if seg_start >= 0 && seg_stop >= 0\n        segs << {seg_start, seg_stop}\n      end\n      seg_start = pos\n    end\n    seg_stop = pos + olen.to_i32\n  end\n  pos = pos + olen.to_i32\nend\nif seg_start >= 0 && seg_stop >= 0\n  segs << {seg_start, seg_stop}\nend\nsegs\n"},"external_var":false},{"html_id":"cigar_start_end_events(cigar,ipos:Int32):Array(Tuple(Int32,Int32))-instance-method","name":"cigar_start_end_events","doc":"Back-compatible helper that allocates a new array (prefer cigar_fill_events!)","summary":"<p>Back-compatible helper that allocates a new array (prefer cigar_fill_events!)</p>","abstract":false,"args":[{"name":"cigar","external_name":"cigar","restriction":""},{"name":"ipos","external_name":"ipos","restriction":"Int32"}],"args_string":"(cigar, ipos : Int32) : Array(Tuple(Int32, Int32))","args_html":"(cigar, ipos : Int32) : Array(Tuple(Int32, Int32))","location":{"filename":"src/depth/core/cigar.cr","line_number":4,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/cigar.cr#L4"},"def":{"name":"cigar_start_end_events","args":[{"name":"cigar","external_name":"cigar","restriction":""},{"name":"ipos","external_name":"ipos","restriction":"Int32"}],"return_type":"Array(Tuple(Int32, Int32))","visibility":"Public","body":"events = [] of Tuple(Int32, Int32)\ncigar_fill_events!(cigar, ipos, events)\nevents\n"},"external_var":false},{"html_id":"inc_coverage(cigar,ipos:Int32,a:Coverage)-instance-method","name":"inc_coverage","abstract":false,"args":[{"name":"cigar","external_name":"cigar","restriction":""},{"name":"ipos","external_name":"ipos","restriction":"Int32"},{"name":"a","external_name":"a","restriction":"Coverage"}],"args_string":"(cigar, ipos : Int32, a : Coverage)","args_html":"(cigar, ipos : Int32, a : <a href=\"../../Depth/Core/Coverage.html\">Coverage</a>)","location":{"filename":"src/depth/core/cigar.cr","line_number":53,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/cigar.cr#L53"},"def":{"name":"inc_coverage","args":[{"name":"cigar","external_name":"cigar","restriction":""},{"name":"ipos","external_name":"ipos","restriction":"Int32"},{"name":"a","external_name":"a","restriction":"Coverage"}],"visibility":"Public","body":"(cigar_start_end_events(cigar, ipos)).each do |pos, val|\n  if pos < 0 || a.empty?\n    next\n  end\n  p = pos.clamp(0, a.size - 1)\n  __temp_152 = p\n  a[__temp_152] = a[__temp_152] + val\nend"},"external_var":false}]},{"html_id":"mopdepth/Depth/Core/Coverage","path":"Depth/Core/Coverage.html","kind":"alias","full_name":"Depth::Core::Coverage","name":"Coverage","abstract":false,"locations":[{"filename":"src/depth/core/coverage.cr","line_number":3,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/coverage.cr#L3"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":true,"aliased":"Array(Int32)","aliased_html":"Array(Int32)","const":false,"namespace":{"html_id":"mopdepth/Depth/Core","kind":"module","full_name":"Depth::Core","name":"Core"},"doc":"coverage array diff representation and cumulative coverage alias","summary":"<p>coverage array diff representation and cumulative coverage alias</p>"},{"html_id":"mopdepth/Depth/Core/CoverageCalculator","path":"Depth/Core/CoverageCalculator.html","kind":"class","full_name":"Depth::Core::CoverageCalculator","name":"CoverageCalculator","abstract":false,"superclass":{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"mopdepth/Depth/Core/Cigar","kind":"module","full_name":"Depth::Core::Cigar","name":"Cigar"},{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mopdepth/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/core/coverage_calculator.cr","line_number":8,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/coverage_calculator.cr#L8"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"mopdepth/Depth/Core/Cigar","kind":"module","full_name":"Depth::Core::Cigar","name":"Cigar"}],"namespace":{"html_id":"mopdepth/Depth/Core","kind":"module","full_name":"Depth::Core","name":"Core"},"constructors":[{"html_id":"new(bam:HTS::Bam,options:Options)-class-method","name":"new","abstract":false,"args":[{"name":"bam","external_name":"bam","restriction":"HTS::Bam"},{"name":"options","external_name":"options","restriction":"Options"}],"args_string":"(bam : HTS::Bam, options : Options)","args_html":"(bam : HTS::Bam, options : <a href=\"../../Depth/Core/Options.html\">Options</a>)","location":{"filename":"src/depth/core/coverage_calculator.cr","line_number":16,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/coverage_calculator.cr#L16"},"def":{"name":"new","args":[{"name":"bam","external_name":"bam","restriction":"HTS::Bam"},{"name":"options","external_name":"options","restriction":"Options"}],"visibility":"Public","body":"_ = allocate\n_.initialize(bam, options)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"calculate(a:Coverage,r:Region|Nil,offset:Int32=0):Int32-instance-method","name":"calculate","doc":"Returns: CoverageResult enum values or tid","summary":"<p>Returns: CoverageResult enum values or tid</p>","abstract":false,"args":[{"name":"a","external_name":"a","restriction":"Coverage"},{"name":"r","external_name":"r","restriction":"Region | ::Nil"},{"name":"offset","default_value":"0","external_name":"offset","restriction":"Int32"}],"args_string":"(a : Coverage, r : Region | Nil, offset : Int32 = 0) : Int32","args_html":"(a : <a href=\"../../Depth/Core/Coverage.html\">Coverage</a>, r : <a href=\"../../Depth/Core/Region.html\">Region</a> | Nil, offset : Int32 = <span class=\"n\">0</span>) : Int32","location":{"filename":"src/depth/core/coverage_calculator.cr","line_number":187,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/coverage_calculator.cr#L187"},"def":{"name":"calculate","args":[{"name":"a","external_name":"a","restriction":"Coverage"},{"name":"r","external_name":"r","restriction":"Region | ::Nil"},{"name":"offset","default_value":"0","external_name":"offset","restriction":"Int32"}],"return_type":"Int32","visibility":"Public","body":"tid = CoverageResult::ChromNotFound.value\nif r\n  tid = @bam.header.get_tid(r.chrom)\nelse\n  tid = CoverageResult::AllChroms.value\nend\n\nif tid == CoverageResult::ChromNotFound.value\n  return CoverageResult::ChromNotFound.value\nend\n\nfound, chrom_tid = if r && tid >= 0\n  process_region_query(a, r, tid, offset)\nelse\n  process_full_scan(a, tid)\nend\n\nif found\nelse\n  return CoverageResult::NoData.value\nend\ntid >= 0 ? tid : chrom_tid\n"},"external_var":false},{"html_id":"initialize_coverage_array(coverage:Coverage,chrom_len:Int32)-instance-method","name":"initialize_coverage_array","doc":"Initialize coverage array for a chromosome","summary":"<p>Initialize coverage array for a chromosome</p>","abstract":false,"args":[{"name":"coverage","external_name":"coverage","restriction":"Coverage"},{"name":"chrom_len","external_name":"chrom_len","restriction":"Int32"}],"args_string":"(coverage : Coverage, chrom_len : Int32)","args_html":"(coverage : <a href=\"../../Depth/Core/Coverage.html\">Coverage</a>, chrom_len : Int32)","location":{"filename":"src/depth/core/coverage_calculator.cr","line_number":129,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/coverage_calculator.cr#L129"},"def":{"name":"initialize_coverage_array","args":[{"name":"coverage","external_name":"coverage","restriction":"Coverage"},{"name":"chrom_len","external_name":"chrom_len","restriction":"Int32"}],"visibility":"Public","body":"target_size = chrom_len + 1\nif coverage.size == target_size\nelse\n  coverage.clear\n  coverage.concat(Array(Int32).new(target_size, 0))\n  ensure_marks_capacity(target_size)\nend\n"},"external_var":false},{"html_id":"reset_coverage!(a:Coverage,limit:Int32)-instance-method","name":"reset_coverage!","doc":"Reset using touch marks: zero only indices written in current generation (up to limit)","summary":"<p>Reset using touch marks: zero only indices written in current generation (up to limit)</p>","abstract":false,"args":[{"name":"a","external_name":"a","restriction":"Coverage"},{"name":"limit","external_name":"limit","restriction":"Int32"}],"args_string":"(a : Coverage, limit : Int32)","args_html":"(a : <a href=\"../../Depth/Core/Coverage.html\">Coverage</a>, limit : Int32)","location":{"filename":"src/depth/core/coverage_calculator.cr","line_number":210,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/coverage_calculator.cr#L210"},"def":{"name":"reset_coverage!","args":[{"name":"a","external_name":"a","restriction":"Coverage"},{"name":"limit","external_name":"limit","restriction":"Int32"}],"visibility":"Public","body":"if @touched.size > 0\n  lim = Math.min(limit, a.size)\n  @touched.each do |idx|\n    if idx >= lim\n      next\n    end\n    a[idx] = 0\n  end\n  @touched.clear\nend\n\n@generation = @generation &+ 1_u32\nif @generation == 0_u32\n  @marks.fill(0_u32)\n  @generation = 1_u32\nend\n"},"external_var":false}]},{"html_id":"mopdepth/Depth/Core/CoverageResult","path":"Depth/Core/CoverageResult.html","kind":"enum","full_name":"Depth::Core::CoverageResult","name":"CoverageResult","abstract":false,"ancestors":[{"html_id":"mopdepth/Enum","kind":"struct","full_name":"Enum","name":"Enum"},{"html_id":"mopdepth/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"mopdepth/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"mopdepth/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/core/coverage_result.cr","line_number":2,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/coverage_result.cr#L2"}],"repository_name":"mopdepth","program":false,"enum":true,"alias":false,"const":false,"constants":[{"id":"ChromNotFound","name":"ChromNotFound","value":"-1"},{"id":"NoData","name":"NoData","value":"-2"},{"id":"AllChroms","name":"AllChroms","value":"-42"}],"namespace":{"html_id":"mopdepth/Depth/Core","kind":"module","full_name":"Depth::Core","name":"Core"},"instance_methods":[{"html_id":"all_chroms?-instance-method","name":"all_chroms?","doc":"Returns `true` if this enum value equals `AllChroms`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../../Depth/Core/CoverageResult.html#AllChroms\">AllChroms</a></code></p>","abstract":false,"location":{"filename":"src/depth/core/coverage_result.cr","line_number":5,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/coverage_result.cr#L5"},"def":{"name":"all_chroms?","visibility":"Public","body":"self == AllChroms"},"external_var":false},{"html_id":"chrom_not_found?-instance-method","name":"chrom_not_found?","doc":"Returns `true` if this enum value equals `ChromNotFound`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../../Depth/Core/CoverageResult.html#ChromNotFound\">ChromNotFound</a></code></p>","abstract":false,"location":{"filename":"src/depth/core/coverage_result.cr","line_number":3,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/coverage_result.cr#L3"},"def":{"name":"chrom_not_found?","visibility":"Public","body":"self == ChromNotFound"},"external_var":false},{"html_id":"no_data?-instance-method","name":"no_data?","doc":"Returns `true` if this enum value equals `NoData`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../../Depth/Core/CoverageResult.html#NoData\">NoData</a></code></p>","abstract":false,"location":{"filename":"src/depth/core/coverage_result.cr","line_number":4,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/coverage_result.cr#L4"},"def":{"name":"no_data?","visibility":"Public","body":"self == NoData"},"external_var":false}]},{"html_id":"mopdepth/Depth/Core/CoverageUtils","path":"Depth/Core/CoverageUtils.html","kind":"module","full_name":"Depth::Core::CoverageUtils","name":"CoverageUtils","abstract":false,"locations":[{"filename":"src/depth/core/coverage_utils.cr","line_number":2,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/coverage_utils.cr#L2"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth/Core","kind":"module","full_name":"Depth::Core","name":"Core"},"instance_methods":[{"html_id":"each_constant_segment(a:Coverage,stop_at:Int32=-1,&)-instance-method","name":"each_constant_segment","doc":"Yield intervals [start, stop) with constant depth value","summary":"<p>Yield intervals [start, stop) with constant depth value</p>","abstract":false,"args":[{"name":"a","external_name":"a","restriction":"Coverage"},{"name":"stop_at","default_value":"-1","external_name":"stop_at","restriction":"Int32"}],"args_string":"(a : Coverage, stop_at : Int32 = -1, &)","args_html":"(a : <a href=\"../../Depth/Core/Coverage.html\">Coverage</a>, stop_at : Int32 = <span class=\"n\">-1</span>, &)","location":{"filename":"src/depth/core/coverage_utils.cr","line_number":15,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/coverage_utils.cr#L15"},"def":{"name":"each_constant_segment","args":[{"name":"a","external_name":"a","restriction":"Coverage"},{"name":"stop_at","default_value":"-1","external_name":"stop_at","restriction":"Int32"}],"yields":1,"block_arity":1,"visibility":"Public","body":"if a.size <= 1\n  return\nend\n\nlast_depth = Int32::MIN\nlast_i = 0\ni = 0\nstop = stop_at <= 0 ? a.size - 1 : stop_at\n\nwhile i < stop\n  depth = a[i]\n  if depth == last_depth\n    i = i + 1\n    next\n  end\n\n  if last_depth != Int32::MIN\n    yield({last_i, i, last_depth})\n  end\n  last_depth = depth\n  last_i = i\n\n  if (i + 1) == stop\n    break\n  end\n  i = i + 1\nend\n\n\nif last_i < stop\n  yield({last_i, stop, last_depth})\nelsif last_i != i\n  yield({last_i - 1, i, last_depth})\nelse\n  yield({last_i, i, last_depth})\nend\n"},"external_var":false},{"html_id":"prefix_sum!(a:Coverage)-instance-method","name":"prefix_sum!","doc":"Utility function for cumulative sum","summary":"<p>Utility function for cumulative sum</p>","abstract":false,"args":[{"name":"a","external_name":"a","restriction":"Coverage"}],"args_string":"(a : Coverage)","args_html":"(a : <a href=\"../../Depth/Core/Coverage.html\">Coverage</a>)","location":{"filename":"src/depth/core/coverage_utils.cr","line_number":4,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/coverage_utils.cr#L4"},"def":{"name":"prefix_sum!","args":[{"name":"a","external_name":"a","restriction":"Coverage"}],"visibility":"Public","body":"sum = 0\ni = 0\nwhile i < a.size\n  sum = sum + a[i]\n  a[i] = sum\n  i = i + 1\nend\n"},"external_var":false}]},{"html_id":"mopdepth/Depth/Core/Options","path":"Depth/Core/Options.html","kind":"struct","full_name":"Depth::Core::Options","name":"Options","abstract":false,"superclass":{"html_id":"mopdepth/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"mopdepth/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"mopdepth/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"mopdepth/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/core/options.cr","line_number":2,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/options.cr#L2"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth/Core","kind":"module","full_name":"Depth::Core","name":"Core"},"constructors":[{"html_id":"new(mapq:Int32=0,min_frag_len:Int32=-1,max_frag_len:Int32=Int32::MAX,exclude_flag:UInt16=1796_u16,include_flag:UInt16=0_u16,fast_mode:Bool=false,fragment_mode:Bool=false,read_groups:Array(String)=[]ofString)-class-method","name":"new","abstract":false,"args":[{"name":"mapq","default_value":"0","external_name":"mapq","restriction":"Int32"},{"name":"min_frag_len","default_value":"-1","external_name":"min_frag_len","restriction":"Int32"},{"name":"max_frag_len","default_value":"Int32::MAX","external_name":"max_frag_len","restriction":"Int32"},{"name":"exclude_flag","default_value":"1796_u16","external_name":"exclude_flag","restriction":"UInt16"},{"name":"include_flag","default_value":"0_u16","external_name":"include_flag","restriction":"UInt16"},{"name":"fast_mode","default_value":"false","external_name":"fast_mode","restriction":"Bool"},{"name":"fragment_mode","default_value":"false","external_name":"fragment_mode","restriction":"Bool"},{"name":"read_groups","default_value":"[] of String","external_name":"read_groups","restriction":"Array(String)"}],"args_string":"(mapq : Int32 = 0, min_frag_len : Int32 = -1, max_frag_len : Int32 = Int32::MAX, exclude_flag : UInt16 = 1796_u16, include_flag : UInt16 = 0_u16, fast_mode : Bool = false, fragment_mode : Bool = false, read_groups : Array(String) = [] of String)","args_html":"(mapq : Int32 = <span class=\"n\">0</span>, min_frag_len : Int32 = <span class=\"n\">-1</span>, max_frag_len : Int32 = <span class=\"t\">Int32</span><span class=\"t\">::</span><span class=\"t\">MAX</span>, exclude_flag : UInt16 = <span class=\"n\">1796_u16</span>, include_flag : UInt16 = <span class=\"n\">0_u16</span>, fast_mode : Bool = <span class=\"n\">false</span>, fragment_mode : Bool = <span class=\"n\">false</span>, read_groups : Array(String) = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>)","location":{"filename":"src/depth/core/options.cr","line_number":2,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/options.cr#L2"},"def":{"name":"new","args":[{"name":"mapq","default_value":"0","external_name":"mapq","restriction":"Int32"},{"name":"min_frag_len","default_value":"-1","external_name":"min_frag_len","restriction":"Int32"},{"name":"max_frag_len","default_value":"Int32::MAX","external_name":"max_frag_len","restriction":"Int32"},{"name":"exclude_flag","default_value":"1796_u16","external_name":"exclude_flag","restriction":"UInt16"},{"name":"include_flag","default_value":"0_u16","external_name":"include_flag","restriction":"UInt16"},{"name":"fast_mode","default_value":"false","external_name":"fast_mode","restriction":"Bool"},{"name":"fragment_mode","default_value":"false","external_name":"fragment_mode","restriction":"Bool"},{"name":"read_groups","default_value":"[] of String","external_name":"read_groups","restriction":"Array(String)"}],"visibility":"Public","body":"_ = allocate\n_.initialize(mapq, min_frag_len, max_frag_len, exclude_flag, include_flag, fast_mode, fragment_mode, read_groups)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"clone-instance-method","name":"clone","abstract":false,"location":{"filename":"src/depth/core/options.cr","line_number":2,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/options.cr#L2"},"def":{"name":"clone","visibility":"Public","body":"self.class.new(@mapq.clone, @min_frag_len.clone, @max_frag_len.clone, @exclude_flag.clone, @include_flag.clone, @fast_mode.clone, @fragment_mode.clone, @read_groups.clone)"},"external_var":false},{"html_id":"copy_with(mapq_mapq=@mapq,min_frag_len_min_frag_len=@min_frag_len,max_frag_len_max_frag_len=@max_frag_len,exclude_flag_exclude_flag=@exclude_flag,include_flag_include_flag=@include_flag,fast_mode_fast_mode=@fast_mode,fragment_mode_fragment_mode=@fragment_mode,read_groups_read_groups=@read_groups)-instance-method","name":"copy_with","abstract":false,"args":[{"name":"_mapq","default_value":"@mapq","external_name":"mapq","restriction":""},{"name":"_min_frag_len","default_value":"@min_frag_len","external_name":"min_frag_len","restriction":""},{"name":"_max_frag_len","default_value":"@max_frag_len","external_name":"max_frag_len","restriction":""},{"name":"_exclude_flag","default_value":"@exclude_flag","external_name":"exclude_flag","restriction":""},{"name":"_include_flag","default_value":"@include_flag","external_name":"include_flag","restriction":""},{"name":"_fast_mode","default_value":"@fast_mode","external_name":"fast_mode","restriction":""},{"name":"_fragment_mode","default_value":"@fragment_mode","external_name":"fragment_mode","restriction":""},{"name":"_read_groups","default_value":"@read_groups","external_name":"read_groups","restriction":""}],"args_string":"(mapq _mapq = @mapq, min_frag_len _min_frag_len = @min_frag_len, max_frag_len _max_frag_len = @max_frag_len, exclude_flag _exclude_flag = @exclude_flag, include_flag _include_flag = @include_flag, fast_mode _fast_mode = @fast_mode, fragment_mode _fragment_mode = @fragment_mode, read_groups _read_groups = @read_groups)","args_html":"(mapq _mapq = @mapq, min_frag_len _min_frag_len = @min_frag_len, max_frag_len _max_frag_len = @max_frag_len, exclude_flag _exclude_flag = @exclude_flag, include_flag _include_flag = @include_flag, fast_mode _fast_mode = @fast_mode, fragment_mode _fragment_mode = @fragment_mode, read_groups _read_groups = @read_groups)","location":{"filename":"src/depth/core/options.cr","line_number":2,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/options.cr#L2"},"def":{"name":"copy_with","args":[{"name":"_mapq","default_value":"@mapq","external_name":"mapq","restriction":""},{"name":"_min_frag_len","default_value":"@min_frag_len","external_name":"min_frag_len","restriction":""},{"name":"_max_frag_len","default_value":"@max_frag_len","external_name":"max_frag_len","restriction":""},{"name":"_exclude_flag","default_value":"@exclude_flag","external_name":"exclude_flag","restriction":""},{"name":"_include_flag","default_value":"@include_flag","external_name":"include_flag","restriction":""},{"name":"_fast_mode","default_value":"@fast_mode","external_name":"fast_mode","restriction":""},{"name":"_fragment_mode","default_value":"@fragment_mode","external_name":"fragment_mode","restriction":""},{"name":"_read_groups","default_value":"@read_groups","external_name":"read_groups","restriction":""}],"visibility":"Public","body":"self.class.new(_mapq, _min_frag_len, _max_frag_len, _exclude_flag, _include_flag, _fast_mode, _fragment_mode, _read_groups)"},"external_var":false},{"html_id":"exclude_flag:UInt16-instance-method","name":"exclude_flag","abstract":false,"def":{"name":"exclude_flag","return_type":"UInt16","visibility":"Public","body":"@exclude_flag"},"external_var":false},{"html_id":"fast_mode:Bool-instance-method","name":"fast_mode","abstract":false,"def":{"name":"fast_mode","return_type":"Bool","visibility":"Public","body":"@fast_mode"},"external_var":false},{"html_id":"fragment_mode:Bool-instance-method","name":"fragment_mode","abstract":false,"def":{"name":"fragment_mode","return_type":"Bool","visibility":"Public","body":"@fragment_mode"},"external_var":false},{"html_id":"include_flag:UInt16-instance-method","name":"include_flag","abstract":false,"def":{"name":"include_flag","return_type":"UInt16","visibility":"Public","body":"@include_flag"},"external_var":false},{"html_id":"mapq:Int32-instance-method","name":"mapq","abstract":false,"def":{"name":"mapq","return_type":"Int32","visibility":"Public","body":"@mapq"},"external_var":false},{"html_id":"max_frag_len:Int32-instance-method","name":"max_frag_len","abstract":false,"def":{"name":"max_frag_len","return_type":"Int32","visibility":"Public","body":"@max_frag_len"},"external_var":false},{"html_id":"min_frag_len:Int32-instance-method","name":"min_frag_len","abstract":false,"def":{"name":"min_frag_len","return_type":"Int32","visibility":"Public","body":"@min_frag_len"},"external_var":false},{"html_id":"read_groups:Array(String)-instance-method","name":"read_groups","abstract":false,"def":{"name":"read_groups","return_type":"Array(String)","visibility":"Public","body":"@read_groups"},"external_var":false}]},{"html_id":"mopdepth/Depth/Core/Region","path":"Depth/Core/Region.html","kind":"struct","full_name":"Depth::Core::Region","name":"Region","abstract":false,"superclass":{"html_id":"mopdepth/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"mopdepth/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"mopdepth/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"mopdepth/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/core/region.cr","line_number":2,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/region.cr#L2"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth/Core","kind":"module","full_name":"Depth::Core","name":"Core"},"constructors":[{"html_id":"new(chrom:String,start:Int32,stop:Int32,name:String|Nil=nil)-class-method","name":"new","abstract":false,"args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"name","default_value":"nil","external_name":"name","restriction":"String | ::Nil"}],"args_string":"(chrom : String, start : Int32, stop : Int32, name : String | Nil = nil)","args_html":"(chrom : String, start : Int32, stop : Int32, name : String | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/depth/core/region.cr","line_number":8,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/region.cr#L8"},"def":{"name":"new","args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"name","default_value":"nil","external_name":"name","restriction":"String | ::Nil"}],"visibility":"Public","body":"_ = allocate\n_.initialize(chrom, start, stop, name)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"chrom:String-instance-method","name":"chrom","abstract":false,"location":{"filename":"src/depth/core/region.cr","line_number":3,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/region.cr#L3"},"def":{"name":"chrom","return_type":"String","visibility":"Public","body":"@chrom"},"external_var":false},{"html_id":"name:String|Nil-instance-method","name":"name","abstract":false,"location":{"filename":"src/depth/core/region.cr","line_number":6,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/region.cr#L6"},"def":{"name":"name","return_type":"String | ::Nil","visibility":"Public","body":"@name"},"external_var":false},{"html_id":"start:Int32-instance-method","name":"start","abstract":false,"location":{"filename":"src/depth/core/region.cr","line_number":4,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/region.cr#L4"},"def":{"name":"start","return_type":"Int32","visibility":"Public","body":"@start"},"external_var":false},{"html_id":"stop:Int32-instance-method","name":"stop","abstract":false,"location":{"filename":"src/depth/core/region.cr","line_number":5,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/region.cr#L5"},"def":{"name":"stop","return_type":"Int32","visibility":"Public","body":"@stop"},"external_var":false},{"html_id":"to_s(io)-instance-method","name":"to_s","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/depth/core/region.cr","line_number":12,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/region.cr#L12"},"def":{"name":"to_s","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"if name\n  ((((((io << chrom) << \":\") << (start + 1)) << \"-\") << stop) << \"\\t\") << name\nelse\n  ((((io << chrom) << \":\") << (start + 1)) << \"-\") << stop\nend"},"external_var":false}]},{"html_id":"mopdepth/Depth/Core/Target","path":"Depth/Core/Target.html","kind":"struct","full_name":"Depth::Core::Target","name":"Target","abstract":false,"superclass":{"html_id":"mopdepth/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"mopdepth/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"mopdepth/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"mopdepth/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/core/target.cr","line_number":2,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/target.cr#L2"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth/Core","kind":"module","full_name":"Depth::Core","name":"Core"},"constructors":[{"html_id":"new(name:String,length:Int32,tid:Int32)-class-method","name":"new","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"length","external_name":"length","restriction":"Int32"},{"name":"tid","external_name":"tid","restriction":"Int32"}],"args_string":"(name : String, length : Int32, tid : Int32)","args_html":"(name : String, length : Int32, tid : Int32)","location":{"filename":"src/depth/core/target.cr","line_number":7,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/target.cr#L7"},"def":{"name":"new","args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"length","external_name":"length","restriction":"Int32"},{"name":"tid","external_name":"tid","restriction":"Int32"}],"visibility":"Public","body":"_ = allocate\n_.initialize(name, length, tid)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"length:Int32-instance-method","name":"length","abstract":false,"location":{"filename":"src/depth/core/target.cr","line_number":4,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/target.cr#L4"},"def":{"name":"length","return_type":"Int32","visibility":"Public","body":"@length"},"external_var":false},{"html_id":"name:String-instance-method","name":"name","abstract":false,"location":{"filename":"src/depth/core/target.cr","line_number":3,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/target.cr#L3"},"def":{"name":"name","return_type":"String","visibility":"Public","body":"@name"},"external_var":false},{"html_id":"tid:Int32-instance-method","name":"tid","abstract":false,"location":{"filename":"src/depth/core/target.cr","line_number":5,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/core/target.cr#L5"},"def":{"name":"tid","return_type":"Int32","visibility":"Public","body":"@tid"},"external_var":false}]}]},{"html_id":"mopdepth/Depth/CoverageCalculationError","path":"Depth/CoverageCalculationError.html","kind":"class","full_name":"Depth::CoverageCalculationError","name":"CoverageCalculationError","abstract":false,"superclass":{"html_id":"mopdepth/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},"ancestors":[{"html_id":"mopdepth/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},{"html_id":"mopdepth/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mopdepth/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/errors.cr","line_number":8,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/errors.cr#L8"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth","kind":"module","full_name":"Depth","name":"Depth"}},{"html_id":"mopdepth/Depth/Error","path":"Depth/Error.html","kind":"class","full_name":"Depth::Error","name":"Error","abstract":false,"superclass":{"html_id":"mopdepth/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"mopdepth/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mopdepth/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/errors.cr","line_number":2,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/errors.cr#L2"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"subclasses":[{"html_id":"mopdepth/Depth/BamIndexError","kind":"class","full_name":"Depth::BamIndexError","name":"BamIndexError"},{"html_id":"mopdepth/Depth/ConfigError","kind":"class","full_name":"Depth::ConfigError","name":"ConfigError"},{"html_id":"mopdepth/Depth/CoverageCalculationError","kind":"class","full_name":"Depth::CoverageCalculationError","name":"CoverageCalculationError"},{"html_id":"mopdepth/Depth/FileNotFoundError","kind":"class","full_name":"Depth::FileNotFoundError","name":"FileNotFoundError"},{"html_id":"mopdepth/Depth/InvalidRegionError","kind":"class","full_name":"Depth::InvalidRegionError","name":"InvalidRegionError"}],"namespace":{"html_id":"mopdepth/Depth","kind":"module","full_name":"Depth","name":"Depth"}},{"html_id":"mopdepth/Depth/FileIO","path":"Depth/FileIO.html","kind":"module","full_name":"Depth::FileIO","name":"FileIO","abstract":false,"locations":[{"filename":"src/depth/io/bed_reader.cr","line_number":3,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/bed_reader.cr#L3"},{"filename":"src/depth/io/output_manager.cr","line_number":5,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L5"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth","kind":"module","full_name":"Depth","name":"Depth"},"class_methods":[{"html_id":"parse_region_str(s:String):Depth::Core::Region|Nil-class-method","name":"parse_region_str","doc":"Parse region like: chr1, chr1:100-200, or BED line","summary":"<p>Parse region like: chr1, chr1:100-200, or BED line</p>","abstract":false,"args":[{"name":"s","external_name":"s","restriction":"String"}],"args_string":"(s : String) : Depth::Core::Region | Nil","args_html":"(s : String) : <a href=\"../Depth/Core/Region.html\">Depth::Core::Region</a> | Nil","location":{"filename":"src/depth/io/bed_reader.cr","line_number":5,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/bed_reader.cr#L5"},"def":{"name":"parse_region_str","args":[{"name":"s","external_name":"s","restriction":"String"}],"return_type":"Depth::Core::Region | ::Nil","visibility":"Public","body":"if s.empty? || (s == \"nil\")\n  return nil\nend\nif s.includes?(':')\n  chrom, rest = s.split(\":\", 2)\n  if rest.includes?('-')\n    st, ed = rest.split('-', 2)\n    Depth::Core::Region.new(chrom, st.to_i - 1, ed.to_i)\n  else\n    Depth::Core::Region.new(chrom, rest.to_i - 1, rest.to_i)\n  end\nelse\n  Depth::Core::Region.new(s, 0, 0)\nend\n"},"external_var":false},{"html_id":"read_bed(path:String):Hash(String,Array(Depth::Core::Region))-class-method","name":"read_bed","doc":"BED reader → {chrom => [Region]}","summary":"<p>BED reader → {chrom =&gt; [Region]}</p>","abstract":false,"args":[{"name":"path","external_name":"path","restriction":"String"}],"args_string":"(path : String) : Hash(String, Array(Depth::Core::Region))","args_html":"(path : String) : Hash(String, Array(<a href=\"../Depth/Core/Region.html\">Depth::Core::Region</a>))","location":{"filename":"src/depth/io/bed_reader.cr","line_number":21,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/bed_reader.cr#L21"},"def":{"name":"read_bed","args":[{"name":"path","external_name":"path","restriction":"String"}],"return_type":"Hash(String, Array(Depth::Core::Region))","visibility":"Public","body":"tbl = Hash(String, Array(Depth::Core::Region)).new do |h, k| h[k] = [] of Depth::Core::Region end\nFile.each_line(path) do |line|\n  if (line.starts_with?(\"#\")) || line.empty?\n    next\n  end\n  if line.starts_with?(\"track \")\n    next\n  end\n  cols = line.rstrip.split('\\t')\n  if cols.size < 3\n    STDERR.puts(\"[mopdepth] skipping bad bed line: #{line}\")\n    next\n  end\n  chrom = cols[0]\n  s = cols[1].to_i\n  e = cols[2].to_i\n  name = cols.size > 3 ? cols[3].strip : nil\n  tbl[chrom] << (Depth::Core::Region.new(chrom, s, e, name))\nend\n\ntbl.each_value(&.sort_by!(&.start))\ntbl\n"},"external_var":false}],"types":[{"html_id":"mopdepth/Depth/FileIO/OutputManager","path":"Depth/FileIO/OutputManager.html","kind":"class","full_name":"Depth::FileIO::OutputManager","name":"OutputManager","abstract":false,"superclass":{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mopdepth/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/io/output_manager.cr","line_number":6,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L6"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth/FileIO","kind":"module","full_name":"Depth::FileIO","name":"FileIO"},"constructors":[{"html_id":"new(config:Config)-class-method","name":"new","abstract":false,"args":[{"name":"config","external_name":"config","restriction":"Config"}],"args_string":"(config : Config)","args_html":"(config : <a href=\"../../Depth/Config.html\">Config</a>)","location":{"filename":"src/depth/io/output_manager.cr","line_number":19,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L19"},"def":{"name":"new","args":[{"name":"config","external_name":"config","restriction":"Config"}],"visibility":"Public","body":"_ = allocate\n_.initialize(config)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"close_all-instance-method","name":"close_all","abstract":false,"location":{"filename":"src/depth/io/output_manager.cr","line_number":127,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L127"},"def":{"name":"close_all","visibility":"Public","body":"[@f_summary, @f_global, @f_region].each(&.try(&.close))\n\n[@f_perbase, @f_regions, @f_quantized, @f_thresholds].each do |io|\n  io.try(&.close)\nend\n\n\nbuild_csi_indices\n"},"external_var":false},{"html_id":"f_global:File|Nil-instance-method","name":"f_global","abstract":false,"location":{"filename":"src/depth/io/output_manager.cr","line_number":8,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L8"},"def":{"name":"f_global","return_type":"File | ::Nil","visibility":"Public","body":"@f_global"},"external_var":false},{"html_id":"f_perbase:File|HTS::Bgzf|Nil-instance-method","name":"f_perbase","abstract":false,"location":{"filename":"src/depth/io/output_manager.cr","line_number":10,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L10"},"def":{"name":"f_perbase","return_type":"File | HTS::Bgzf | ::Nil","visibility":"Public","body":"@f_perbase"},"external_var":false},{"html_id":"f_quantized:File|HTS::Bgzf|Nil-instance-method","name":"f_quantized","abstract":false,"location":{"filename":"src/depth/io/output_manager.cr","line_number":12,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L12"},"def":{"name":"f_quantized","return_type":"File | HTS::Bgzf | ::Nil","visibility":"Public","body":"@f_quantized"},"external_var":false},{"html_id":"f_region:File|Nil-instance-method","name":"f_region","abstract":false,"location":{"filename":"src/depth/io/output_manager.cr","line_number":9,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L9"},"def":{"name":"f_region","return_type":"File | ::Nil","visibility":"Public","body":"@f_region"},"external_var":false},{"html_id":"f_regions:File|HTS::Bgzf|Nil-instance-method","name":"f_regions","abstract":false,"location":{"filename":"src/depth/io/output_manager.cr","line_number":11,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L11"},"def":{"name":"f_regions","return_type":"File | HTS::Bgzf | ::Nil","visibility":"Public","body":"@f_regions"},"external_var":false},{"html_id":"f_summary:File|Nil-instance-method","name":"f_summary","abstract":false,"location":{"filename":"src/depth/io/output_manager.cr","line_number":7,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L7"},"def":{"name":"f_summary","return_type":"File | ::Nil","visibility":"Public","body":"@f_summary"},"external_var":false},{"html_id":"f_thresholds:File|HTS::Bgzf|Nil-instance-method","name":"f_thresholds","abstract":false,"location":{"filename":"src/depth/io/output_manager.cr","line_number":13,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L13"},"def":{"name":"f_thresholds","return_type":"File | HTS::Bgzf | ::Nil","visibility":"Public","body":"@f_thresholds"},"external_var":false},{"html_id":"write_per_base_interval(chrom:String,start:Int32,stop:Int32,depth:Int32)-instance-method","name":"write_per_base_interval","abstract":false,"args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"depth","external_name":"depth","restriction":"Int32"}],"args_string":"(chrom : String, start : Int32, stop : Int32, depth : Int32)","args_html":"(chrom : String, start : Int32, stop : Int32, depth : Int32)","location":{"filename":"src/depth/io/output_manager.cr","line_number":88,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L88"},"def":{"name":"write_per_base_interval","args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"depth","external_name":"depth","restriction":"Int32"}],"visibility":"Public","body":"if @f_perbase\nelse\n  return\nend\n@f_perbase.not_nil!.puts(\"#{chrom}\\t#{start}\\t#{stop}\\t#{depth}\")\n"},"external_var":false},{"html_id":"write_quantized_interval(chrom:String,start:Int32,stop:Int32,label:String)-instance-method","name":"write_quantized_interval","abstract":false,"args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"label","external_name":"label","restriction":"String"}],"args_string":"(chrom : String, start : Int32, stop : Int32, label : String)","args_html":"(chrom : String, start : Int32, stop : Int32, label : String)","location":{"filename":"src/depth/io/output_manager.cr","line_number":104,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L104"},"def":{"name":"write_quantized_interval","args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"label","external_name":"label","restriction":"String"}],"visibility":"Public","body":"if @f_quantized\nelse\n  return\nend\n@f_quantized.not_nil!.puts(\"#{chrom}\\t#{start}\\t#{stop}\\t#{label}\")\n"},"external_var":false},{"html_id":"write_region_stat(chrom:String,start:Int32,stop:Int32,name:String|Nil,value:Float64)-instance-method","name":"write_region_stat","abstract":false,"args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"name","external_name":"name","restriction":"String | ::Nil"},{"name":"value","external_name":"value","restriction":"Float64"}],"args_string":"(chrom : String, start : Int32, stop : Int32, name : String | Nil, value : Float64)","args_html":"(chrom : String, start : Int32, stop : Int32, name : String | Nil, value : Float64)","location":{"filename":"src/depth/io/output_manager.cr","line_number":93,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L93"},"def":{"name":"write_region_stat","args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"name","external_name":"name","restriction":"String | ::Nil"},{"name":"value","external_name":"value","restriction":"Float64"}],"visibility":"Public","body":"if @f_regions\nelse\n  return\nend\npr = ((ENV[\"MOPDEPTH_PRECISION\"]?.try(&.to_i?)) || (ENV[\"MOSDEPTH_PRECISION\"]?.try(&.to_i?))) || 2\nval_str = sprintf(\"%.#{pr}f\", value)\nif name\n  @f_regions.not_nil!.puts(\"#{chrom}\\t#{start}\\t#{stop}\\t#{name}\\t#{val_str}\")\nelse\n  @f_regions.not_nil!.puts(\"#{chrom}\\t#{start}\\t#{stop}\\t#{val_str}\")\nend\n"},"external_var":false},{"html_id":"write_summary_line(region:String,stat:Depth::Stats::DepthStat)-instance-method","name":"write_summary_line","abstract":false,"args":[{"name":"region","external_name":"region","restriction":"String"},{"name":"stat","external_name":"stat","restriction":"Depth::Stats::DepthStat"}],"args_string":"(region : String, stat : Depth::Stats::DepthStat)","args_html":"(region : String, stat : <a href=\"../../Depth/Stats/DepthStat.html\">Depth::Stats::DepthStat</a>)","location":{"filename":"src/depth/io/output_manager.cr","line_number":62,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L62"},"def":{"name":"write_summary_line","args":[{"name":"region","external_name":"region","restriction":"String"},{"name":"stat","external_name":"stat","restriction":"Depth::Stats::DepthStat"}],"visibility":"Public","body":"if @f_summary\nelse\n  return\nend\n\nif @header_written\nelse\n  (@f_summary.not_nil! << ([\"chrom\", \"length\", \"bases\", \"mean\", \"min\", \"max\"].join(\"\\t\"))) << '\\n'\n  @header_written = true\nend\n\nmean = stat.n_bases > 0 ? stat.sum_depth.to_f / stat.n_bases : 0.0\npr = ((ENV[\"MOPDEPTH_PRECISION\"]?.try(&.to_i?)) || (ENV[\"MOSDEPTH_PRECISION\"]?.try(&.to_i?))) || 2\nmean_str = sprintf(\"%.#{pr}f\", mean)\nminv = stat.min_depth == Int32::MAX ? 0 : stat.min_depth\n\n(@f_summary.not_nil! << ([region, stat.n_bases, stat.sum_depth, mean_str, minv, stat.max_depth].join(\"\\t\"))) << '\\n'\n"},"external_var":false},{"html_id":"write_summary_total(total:Depth::Stats::DepthStat)-instance-method","name":"write_summary_total","doc":"Optionally call at end to add a total line like mosdepth","summary":"<p>Optionally call at end to add a total line like mosdepth</p>","abstract":false,"args":[{"name":"total","external_name":"total","restriction":"Depth::Stats::DepthStat"}],"args_string":"(total : Depth::Stats::DepthStat)","args_html":"(total : <a href=\"../../Depth/Stats/DepthStat.html\">Depth::Stats::DepthStat</a>)","location":{"filename":"src/depth/io/output_manager.cr","line_number":79,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L79"},"def":{"name":"write_summary_total","args":[{"name":"total","external_name":"total","restriction":"Depth::Stats::DepthStat"}],"visibility":"Public","body":"if @f_summary\nelse\n  return\nend\nmean = total.n_bases > 0 ? total.sum_depth.to_f / total.n_bases : 0.0\npr = ((ENV[\"MOPDEPTH_PRECISION\"]?.try(&.to_i?)) || (ENV[\"MOSDEPTH_PRECISION\"]?.try(&.to_i?))) || 2\nmean_str = sprintf(\"%.#{pr}f\", mean)\nminv = total.min_depth == Int32::MAX ? 0 : total.min_depth\n(@f_summary.not_nil! << ([\"total\", total.n_bases, total.sum_depth, mean_str, minv, total.max_depth].join(\"\\t\"))) << \"\\n\"\n"},"external_var":false},{"html_id":"write_threshold_counts(chrom:String,start:Int32,stop:Int32,name:String|Nil,counts:Array(Int32))-instance-method","name":"write_threshold_counts","abstract":false,"args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"name","external_name":"name","restriction":"String | ::Nil"},{"name":"counts","external_name":"counts","restriction":"Array(Int32)"}],"args_string":"(chrom : String, start : Int32, stop : Int32, name : String | Nil, counts : Array(Int32))","args_html":"(chrom : String, start : Int32, stop : Int32, name : String | Nil, counts : Array(Int32))","location":{"filename":"src/depth/io/output_manager.cr","line_number":118,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L118"},"def":{"name":"write_threshold_counts","args":[{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"start","external_name":"start","restriction":"Int32"},{"name":"stop","external_name":"stop","restriction":"Int32"},{"name":"name","external_name":"name","restriction":"String | ::Nil"},{"name":"counts","external_name":"counts","restriction":"Array(Int32)"}],"visibility":"Public","body":"if @f_thresholds\nelse\n  return\nend\nline = String.build do |io|\n  ((((((io << chrom) << '\\t') << start) << '\\t') << stop) << '\\t') << (name || \"unknown\")\n  counts.each do |c| (io << '\\t') << c end\nend\n@f_thresholds.not_nil!.puts(line)\n"},"external_var":false},{"html_id":"write_thresholds_header(thresholds:Array(Int32))-instance-method","name":"write_thresholds_header","abstract":false,"args":[{"name":"thresholds","external_name":"thresholds","restriction":"Array(Int32)"}],"args_string":"(thresholds : Array(Int32))","args_html":"(thresholds : Array(Int32))","location":{"filename":"src/depth/io/output_manager.cr","line_number":109,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/io/output_manager.cr#L109"},"def":{"name":"write_thresholds_header","args":[{"name":"thresholds","external_name":"thresholds","restriction":"Array(Int32)"}],"visibility":"Public","body":"if @f_thresholds\nelse\n  return\nend\nline = String.build do |io|\n  io << \"#chrom\\tstart\\tend\\tregion\"\n  thresholds.each do |t| ((io << \"\\t\") << t) << \"X\" end\nend\n@f_thresholds.not_nil!.puts(line)\n"},"external_var":false}]}]},{"html_id":"mopdepth/Depth/FileNotFoundError","path":"Depth/FileNotFoundError.html","kind":"class","full_name":"Depth::FileNotFoundError","name":"FileNotFoundError","abstract":false,"superclass":{"html_id":"mopdepth/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},"ancestors":[{"html_id":"mopdepth/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},{"html_id":"mopdepth/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mopdepth/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/errors.cr","line_number":4,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/errors.cr#L4"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth","kind":"module","full_name":"Depth","name":"Depth"}},{"html_id":"mopdepth/Depth/InvalidRegionError","path":"Depth/InvalidRegionError.html","kind":"class","full_name":"Depth::InvalidRegionError","name":"InvalidRegionError","abstract":false,"superclass":{"html_id":"mopdepth/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},"ancestors":[{"html_id":"mopdepth/Depth/Error","kind":"class","full_name":"Depth::Error","name":"Error"},{"html_id":"mopdepth/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mopdepth/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/errors.cr","line_number":6,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/errors.cr#L6"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth","kind":"module","full_name":"Depth","name":"Depth"}},{"html_id":"mopdepth/Depth/Runner","path":"Depth/Runner.html","kind":"class","full_name":"Depth::Runner","name":"Runner","abstract":false,"superclass":{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mopdepth/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/runner.cr","line_number":15,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/runner.cr#L15"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"extended_modules":[{"html_id":"mopdepth/Depth/Core/CoverageUtils","kind":"module","full_name":"Depth::Core::CoverageUtils","name":"CoverageUtils"},{"html_id":"mopdepth/Depth/Stats/Distribution","kind":"module","full_name":"Depth::Stats::Distribution","name":"Distribution"}],"namespace":{"html_id":"mopdepth/Depth","kind":"module","full_name":"Depth","name":"Depth"},"constructors":[{"html_id":"new(config:Config)-class-method","name":"new","abstract":false,"args":[{"name":"config","external_name":"config","restriction":"Config"}],"args_string":"(config : Config)","args_html":"(config : <a href=\"../Depth/Config.html\">Config</a>)","location":{"filename":"src/depth/runner.cr","line_number":19,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/runner.cr#L19"},"def":{"name":"new","args":[{"name":"config","external_name":"config","restriction":"Config"}],"visibility":"Public","body":"_ = allocate\n_.initialize(config)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"run-instance-method","name":"run","abstract":false,"location":{"filename":"src/depth/runner.cr","line_number":22,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/runner.cr#L22"},"def":{"name":"run","visibility":"Public","body":"@config.validate!\n\n\nbam = HTS::Bam.open(@config.path, threads: @config.threads)\nbegin\n  bam.load_index\nrescue ex\n  raise(\"Failed to load index for #{@config.path}: #{ex.message}\")\nend\n\nregion = FileIO.parse_region_str(@config.chrom)\nopts = @config.to_options\n\n\noutput = FileIO::OutputManager.new(@config)\n\n\nif @config.has_thresholds?\n  thresholds = @config.threshold_values\n  output.write_thresholds_header(thresholds)\nend\n\nbegin\n  target_names = bam.header.target_names\n  target_lengths = bam.header.target_len\n  targets = target_names.map_with_index do |name, i|\n    Core::Target.new(name, target_lengths[i].to_i32, i)\n  end\n\n  sub_targets = if region\n    selected = targets.select do |t| t.name == region.not_nil!.chrom end\n\n    if selected.empty?\n      raise(ConfigError.new(\"Chromosome not found: #{region.not_nil!.chrom}\"))\n    end\n    selected\n  else\n    targets\n  end\n\n\n  global_dist = Array(Int64).new(512, 0_i64)\n  total_global_dist = Array(Int64).new(512, 0_i64)\n  region_dist = Array(Int64).new(512, 0_i64)\n  total_region_dist = Array(Int64).new(512, 0_i64)\n  global_stat = Stats::DepthStat.new\n  cs = Stats::IntHistogram.new(@config.use_median? ? 65536 : 0)\n\n\n  bed_map : Hash(String, Array(Core::Region)) | ::Nil = nil\n  window = @config.window_size\n  if bed_path = @config.bed_path\n    bed_map = FileIO.read_bed(bed_path)\n  end\n\n\n  calculator = Core::CoverageCalculator.new(bam, opts)\n\n\n  coverage = Core::Coverage.new(0)\n\n\n  sub_targets.each do |t|\n\n    if (@config.no_per_base? && bed_map) && !(bed_map.not_nil!.has_key?(t.name))\n      next\n    end\n\n\n    query_region = if region && (t.name == region.not_nil!.chrom)\n      region.not_nil!\n    else\n      Core::Region.new(t.name, 0, 0)\n    end\n\n\n    offset = 0\n    effective_len = t.length\n    if (region && (t.name == region.not_nil!.chrom)) && (query_region.start > 0 || query_region.stop > 0)\n      offset = query_region.start\n      stop = (query_region.stop > 0 ? query_region.stop : t.length)\n      effective_len = (stop - offset)\n    end\n\n    target_size = effective_len + 1\n    if coverage.size < target_size\n      coverage.concat(Array(Int32).new(target_size - coverage.size, 0))\n    end\n\n    calculator.reset_coverage!(coverage, target_size)\n\n    tid = calculator.calculate(coverage, query_region, offset)\n    if tid == Core::CoverageResult::ChromNotFound.value\n      next\n    end\n\n\n    if tid != Core::CoverageResult::NoData.value\n      i = 0\n      sum = 0\n      while i < target_size\n        sum = sum + coverage[i]\n        coverage[i] = sum\n        i = i + 1\n      end\n    end\n\n\n    if output.f_perbase\n      if tid == Core::CoverageResult::NoData.value\n        write_len = (region && (t.name == region.not_nil!.chrom)) ? effective_len : t.length\n        output.write_per_base_interval(t.name, offset, offset + write_len, 0)\n      else\n        self.class.each_constant_segment(coverage, target_size - 1) do |__temp_140|\n          s, e, v = __temp_140\n          output.write_per_base_interval(t.name, s + offset, e + offset, v)\n        end\n      end\n    end\n\n\n    if output.f_quantized && @config.has_quantize?\n      write_quantized_intervals(t, coverage, tid, output, offset, target_size)\n    end\n\n\n    if output.f_regions\n      write_region_stats_with_offset(t, coverage, tid, window, bed_map, cs, output, region_dist, offset, effective_len)\n    end\n\n\n    if tid != Core::CoverageResult::NoData.value\n      self.class.bump_distribution!(global_dist, coverage, 0, target_size - 1)\n      chrom_stat = Stats::DepthStat.from_array(coverage, 0, target_size - 2)\n      global_stat = global_stat + chrom_stat\n      output.write_summary_line(t.name, chrom_stat)\n    end\n\n\n    if f_global = output.f_global\n      self.class.write_distribution(f_global.as(::IO), t.name, global_dist)\n\n      self.class.sum_into!(total_global_dist, global_dist)\n    end\n    if f_region = output.f_region\n      self.class.write_distribution(f_region.as(::IO), t.name, region_dist)\n\n      self.class.sum_into!(total_region_dist, region_dist)\n      region_dist.fill(0_i64)\n    end\n    global_dist.fill(0_i64)\n  end\n\n  output.write_summary_total(global_stat)\n  if f_global = output.f_global\n    self.class.write_distribution(f_global.as(::IO), \"total\", total_global_dist)\n  end\n  if f_region = output.f_region\n    self.class.write_distribution(f_region.as(::IO), \"total\", total_region_dist)\n  end\nensure\n  output.close_all\nend\n"},"external_var":false}]},{"html_id":"mopdepth/Depth/Stats","path":"Depth/Stats.html","kind":"module","full_name":"Depth::Stats","name":"Stats","abstract":false,"locations":[{"filename":"src/depth/stats/depth_stat.cr","line_number":1,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L1"},{"filename":"src/depth/stats/distribution.cr","line_number":1,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/distribution.cr#L1"},{"filename":"src/depth/stats/int_histogram.cr","line_number":1,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/int_histogram.cr#L1"},{"filename":"src/depth/stats/quantize.cr","line_number":1,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/quantize.cr#L1"},{"filename":"src/depth/stats/threshold.cr","line_number":1,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/threshold.cr#L1"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth","kind":"module","full_name":"Depth","name":"Depth"},"class_methods":[{"html_id":"threshold_args(ts:String):Array(Int32)-class-method","name":"threshold_args","doc":"Parse threshold arguments string like \"1,2,3\" into array of integers","summary":"<p>Parse threshold arguments string like &quot;1,2,3&quot; into array of integers</p>","abstract":false,"args":[{"name":"ts","external_name":"ts","restriction":"String"}],"args_string":"(ts : String) : Array(Int32)","args_html":"(ts : String) : Array(Int32)","location":{"filename":"src/depth/stats/threshold.cr","line_number":3,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/threshold.cr#L3"},"def":{"name":"threshold_args","args":[{"name":"ts","external_name":"ts","restriction":"String"}],"return_type":"Array(Int32)","visibility":"Public","body":"if ts.empty? || (ts == \"nil\")\n  return [] of Int32\nend\n\nbegin\n  result = (ts.split(',')).map(&.to_i)\n  result.sort!\n  result\nrescue ArgumentError\n  raise(ArgumentError.new(\"Invalid threshold string: '#{ts}'\"))\nend\n"},"external_var":false}],"types":[{"html_id":"mopdepth/Depth/Stats/DepthStat","path":"Depth/Stats/DepthStat.html","kind":"struct","full_name":"Depth::Stats::DepthStat","name":"DepthStat","abstract":false,"superclass":{"html_id":"mopdepth/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"mopdepth/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"mopdepth/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"mopdepth/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/stats/depth_stat.cr","line_number":2,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L2"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth/Stats","kind":"module","full_name":"Depth::Stats","name":"Stats"},"class_methods":[{"html_id":"from_array(array:Array(Int32),start_idx:Int32=0,end_idx:Int32=-1)-class-method","name":"from_array","abstract":false,"args":[{"name":"array","external_name":"array","restriction":"Array(Int32)"},{"name":"start_idx","default_value":"0","external_name":"start_idx","restriction":"Int32"},{"name":"end_idx","default_value":"-1","external_name":"end_idx","restriction":"Int32"}],"args_string":"(array : Array(Int32), start_idx : Int32 = 0, end_idx : Int32 = -1)","args_html":"(array : Array(Int32), start_idx : Int32 = <span class=\"n\">0</span>, end_idx : Int32 = <span class=\"n\">-1</span>)","location":{"filename":"src/depth/stats/depth_stat.cr","line_number":30,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L30"},"def":{"name":"from_array","args":[{"name":"array","external_name":"array","restriction":"Array(Int32)"},{"name":"start_idx","default_value":"0","external_name":"start_idx","restriction":"Int32"},{"name":"end_idx","default_value":"-1","external_name":"end_idx","restriction":"Int32"}],"visibility":"Public","body":"s = DepthStat.new\nif end_idx < 0\n  end_idx = array.size - 1\nend\ns.n_bases = (end_idx - start_idx) + 1\n(start_idx..end_idx).each do |i|\n  v = array[i]\n  s.sum_depth = s.sum_depth + v.to_u64\n  if v < s.min_depth\n    s.min_depth = v\n  end\n  if v > s.max_depth\n    s.max_depth = v\n  end\n  if v > 0\n    s.bases = s.bases + 1\n  end\nend\ns\n"},"external_var":false},{"html_id":"from_slice(slice:Slice(Int32))-class-method","name":"from_slice","abstract":false,"args":[{"name":"slice","external_name":"slice","restriction":"Slice(Int32)"}],"args_string":"(slice : Slice(Int32))","args_html":"(slice : Slice(Int32))","location":{"filename":"src/depth/stats/depth_stat.cr","line_number":18,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L18"},"def":{"name":"from_slice","args":[{"name":"slice","external_name":"slice","restriction":"Slice(Int32)"}],"visibility":"Public","body":"s = DepthStat.new\ns.n_bases = slice.size\nslice.each do |v|\n  s.sum_depth = s.sum_depth + v.to_u64\n  if v < s.min_depth\n    s.min_depth = v\n  end\n  if v > s.max_depth\n    s.max_depth = v\n  end\n  if v > 0\n    s.bases = s.bases + 1\n  end\nend\ns\n"},"external_var":false}],"constructors":[{"html_id":"new-class-method","name":"new","abstract":false,"location":{"filename":"src/depth/stats/depth_stat.cr","line_number":2,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L2"},"def":{"name":"new","visibility":"Public","body":"x = allocate\nif x.responds_to?(:finalize)\n  ::GC.add_finalizer(x)\nend\nx\n"},"external_var":false}],"instance_methods":[{"html_id":"+(other:DepthStat):DepthStat-instance-method","name":"+","abstract":false,"args":[{"name":"other","external_name":"other","restriction":"DepthStat"}],"args_string":"(other : DepthStat) : DepthStat","args_html":"(other : <a href=\"../../Depth/Stats/DepthStat.html\">DepthStat</a>) : <a href=\"../../Depth/Stats/DepthStat.html\">DepthStat</a>","location":{"filename":"src/depth/stats/depth_stat.cr","line_number":44,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L44"},"def":{"name":"+","args":[{"name":"other","external_name":"other","restriction":"DepthStat"}],"return_type":"DepthStat","visibility":"Public","body":"result = DepthStat.new\nresult.n_bases = self.n_bases + other.n_bases\nresult.sum_depth = self.sum_depth + other.sum_depth\nresult.min_depth = {self.min_depth, other.min_depth}.min\nresult.max_depth = {self.max_depth, other.max_depth}.max\nresult.bases = self.bases + other.bases\nresult\n"},"external_var":false},{"html_id":"bases:Int32-instance-method","name":"bases","doc":"number of bases with coverage > 0 (mosdepth \"bases\")","summary":"<p>number of bases with coverage &gt; 0 (mosdepth &quot;bases&quot;)</p>","abstract":false,"location":{"filename":"src/depth/stats/depth_stat.cr","line_number":8,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L8"},"def":{"name":"bases","return_type":"Int32","visibility":"Public","body":"@bases"},"external_var":false},{"html_id":"bases=(bases:Int32)-instance-method","name":"bases=","doc":"number of bases with coverage > 0 (mosdepth \"bases\")","summary":"<p>number of bases with coverage &gt; 0 (mosdepth &quot;bases&quot;)</p>","abstract":false,"args":[{"name":"bases","external_name":"bases","restriction":"Int32"}],"args_string":"(bases : Int32)","args_html":"(bases : Int32)","location":{"filename":"src/depth/stats/depth_stat.cr","line_number":8,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L8"},"def":{"name":"bases=","args":[{"name":"bases","external_name":"bases","restriction":"Int32"}],"visibility":"Public","body":"@bases = bases"},"external_var":false},{"html_id":"clear-instance-method","name":"clear","abstract":false,"location":{"filename":"src/depth/stats/depth_stat.cr","line_number":10,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L10"},"def":{"name":"clear","visibility":"Public","body":"@n_bases = 0\n@sum_depth = 0_u64\n@min_depth = Int32::MAX\n@max_depth = 0\n@bases = 0\n"},"external_var":false},{"html_id":"initialize-instance-method","name":"initialize","abstract":false,"location":{"filename":"src/depth/stats/depth_stat.cr","line_number":2,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L2"},"def":{"name":"initialize","visibility":"Public","body":""},"external_var":false},{"html_id":"max_depth:Int32-instance-method","name":"max_depth","abstract":false,"location":{"filename":"src/depth/stats/depth_stat.cr","line_number":6,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L6"},"def":{"name":"max_depth","return_type":"Int32","visibility":"Public","body":"@max_depth"},"external_var":false},{"html_id":"max_depth=(max_depth:Int32)-instance-method","name":"max_depth=","abstract":false,"args":[{"name":"max_depth","external_name":"max_depth","restriction":"Int32"}],"args_string":"(max_depth : Int32)","args_html":"(max_depth : Int32)","location":{"filename":"src/depth/stats/depth_stat.cr","line_number":6,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L6"},"def":{"name":"max_depth=","args":[{"name":"max_depth","external_name":"max_depth","restriction":"Int32"}],"visibility":"Public","body":"@max_depth = max_depth"},"external_var":false},{"html_id":"min_depth:Int32-instance-method","name":"min_depth","abstract":false,"location":{"filename":"src/depth/stats/depth_stat.cr","line_number":5,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L5"},"def":{"name":"min_depth","return_type":"Int32","visibility":"Public","body":"@min_depth"},"external_var":false},{"html_id":"min_depth=(min_depth:Int32)-instance-method","name":"min_depth=","abstract":false,"args":[{"name":"min_depth","external_name":"min_depth","restriction":"Int32"}],"args_string":"(min_depth : Int32)","args_html":"(min_depth : Int32)","location":{"filename":"src/depth/stats/depth_stat.cr","line_number":5,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L5"},"def":{"name":"min_depth=","args":[{"name":"min_depth","external_name":"min_depth","restriction":"Int32"}],"visibility":"Public","body":"@min_depth = min_depth"},"external_var":false},{"html_id":"n_bases:Int32-instance-method","name":"n_bases","abstract":false,"location":{"filename":"src/depth/stats/depth_stat.cr","line_number":3,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L3"},"def":{"name":"n_bases","return_type":"Int32","visibility":"Public","body":"@n_bases"},"external_var":false},{"html_id":"n_bases=(n_bases:Int32)-instance-method","name":"n_bases=","abstract":false,"args":[{"name":"n_bases","external_name":"n_bases","restriction":"Int32"}],"args_string":"(n_bases : Int32)","args_html":"(n_bases : Int32)","location":{"filename":"src/depth/stats/depth_stat.cr","line_number":3,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L3"},"def":{"name":"n_bases=","args":[{"name":"n_bases","external_name":"n_bases","restriction":"Int32"}],"visibility":"Public","body":"@n_bases = n_bases"},"external_var":false},{"html_id":"sum_depth:UInt64-instance-method","name":"sum_depth","abstract":false,"location":{"filename":"src/depth/stats/depth_stat.cr","line_number":4,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L4"},"def":{"name":"sum_depth","return_type":"UInt64","visibility":"Public","body":"@sum_depth"},"external_var":false},{"html_id":"sum_depth=(sum_depth:UInt64)-instance-method","name":"sum_depth=","abstract":false,"args":[{"name":"sum_depth","external_name":"sum_depth","restriction":"UInt64"}],"args_string":"(sum_depth : UInt64)","args_html":"(sum_depth : UInt64)","location":{"filename":"src/depth/stats/depth_stat.cr","line_number":4,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/depth_stat.cr#L4"},"def":{"name":"sum_depth=","args":[{"name":"sum_depth","external_name":"sum_depth","restriction":"UInt64"}],"visibility":"Public","body":"@sum_depth = sum_depth"},"external_var":false}]},{"html_id":"mopdepth/Depth/Stats/Distribution","path":"Depth/Stats/Distribution.html","kind":"module","full_name":"Depth::Stats::Distribution","name":"Distribution","abstract":false,"locations":[{"filename":"src/depth/stats/distribution.cr","line_number":2,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/distribution.cr#L2"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth/Stats","kind":"module","full_name":"Depth::Stats","name":"Stats"},"instance_methods":[{"html_id":"bump_distribution!(dist:Array(Int64),a:Depth::Core::Coverage,start_i:Int32,stop_i:Int32)-instance-method","name":"bump_distribution!","abstract":false,"args":[{"name":"dist","external_name":"dist","restriction":"Array(Int64)"},{"name":"a","external_name":"a","restriction":"Depth::Core::Coverage"},{"name":"start_i","external_name":"start_i","restriction":"Int32"},{"name":"stop_i","external_name":"stop_i","restriction":"Int32"}],"args_string":"(dist : Array(Int64), a : Depth::Core::Coverage, start_i : Int32, stop_i : Int32)","args_html":"(dist : Array(Int64), a : <a href=\"../../Depth/Core/Coverage.html\">Depth::Core::Coverage</a>, start_i : Int32, stop_i : Int32)","location":{"filename":"src/depth/stats/distribution.cr","line_number":3,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/distribution.cr#L3"},"def":{"name":"bump_distribution!","args":[{"name":"dist","external_name":"dist","restriction":"Array(Int64)"},{"name":"a","external_name":"a","restriction":"Depth::Core::Coverage"},{"name":"start_i","external_name":"start_i","restriction":"Int32"},{"name":"stop_i","external_name":"stop_i","restriction":"Int32"}],"visibility":"Public","body":"istop = Math.min(stop_i, a.size)\ni = start_i\nwhile i < istop\n  v = a[i]\n  if v > Depth::Core::MAX_COVERAGE\n    v = Depth::Core::MAX_COVERAGE - 10\n  end\n  if v >= dist.size\n    old = dist.size\n    new_size = v + 10\n    dist.concat(Array.new(new_size - old, 0_i64))\n  end\n  if v >= 0\n    __temp_156 = v\n    dist[__temp_156] = dist[__temp_156] + 1\n  end\n  i = i + 1\nend\n"},"external_var":false},{"html_id":"sum_into!(dist_to:Array(Int64),dist_from:Array(Int64))-instance-method","name":"sum_into!","doc":"Add dist_from into dist_to, resizing dist_to if needed (mosdepth sum_into)","summary":"<p>Add dist_from into dist_to, resizing dist_to if needed (mosdepth sum_into)</p>","abstract":false,"args":[{"name":"dist_to","external_name":"dist_to","restriction":"Array(Int64)"},{"name":"dist_from","external_name":"dist_from","restriction":"Array(Int64)"}],"args_string":"(dist_to : Array(Int64), dist_from : Array(Int64))","args_html":"(dist_to : Array(Int64), dist_from : Array(Int64))","location":{"filename":"src/depth/stats/distribution.cr","line_number":36,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/distribution.cr#L36"},"def":{"name":"sum_into!","args":[{"name":"dist_to","external_name":"dist_to","restriction":"Array(Int64)"},{"name":"dist_from","external_name":"dist_from","restriction":"Array(Int64)"}],"visibility":"Public","body":"if dist_from.size > dist_to.size\n  old = dist_to.size\n  dist_to.concat(Array.new(dist_from.size - old, 0_i64))\nend\ni = 0\nwhile i < dist_from.size\n  __temp_158 = i\n  dist_to[__temp_158] = dist_to[__temp_158] + dist_from[i]\n  i = i + 1\nend\n"},"external_var":false},{"html_id":"write_distribution(io:IO,chrom:String,dist:Array(Int64))-instance-method","name":"write_distribution","abstract":false,"args":[{"name":"io","external_name":"io","restriction":"::IO"},{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"dist","external_name":"dist","restriction":"Array(Int64)"}],"args_string":"(io : IO, chrom : String, dist : Array(Int64))","args_html":"(io : IO, chrom : String, dist : Array(Int64))","location":{"filename":"src/depth/stats/distribution.cr","line_number":19,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/distribution.cr#L19"},"def":{"name":"write_distribution","args":[{"name":"io","external_name":"io","restriction":"::IO"},{"name":"chrom","external_name":"chrom","restriction":"String"},{"name":"dist","external_name":"dist","restriction":"Array(Int64)"}],"visibility":"Public","body":"sum = dist.sum\nif sum < 1\n  return\nend\n\nrev = dist.dup.reverse\ncum = 0.0\npr = (ENV[\"MOSDEPTH_PRECISION\"]?.try(&.to_i?)) || 2\nrev.each_with_index do |v, i|\n  irev = (dist.size - i) - 1\n  if irev > 300 && (v == 0)\n    next\n  end\n  cum = cum + (v.to_f / sum)\n  if cum < 8e-5\n    next\n  end\n  (((((io << chrom) << \"\\t\") << irev) << \"\\t\") << (sprintf(\"%.#{pr}f\", cum))) << '\\n'\nend\n"},"external_var":false}]},{"html_id":"mopdepth/Depth/Stats/IntHistogram","path":"Depth/Stats/IntHistogram.html","kind":"class","full_name":"Depth::Stats::IntHistogram","name":"IntHistogram","abstract":false,"superclass":{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"mopdepth/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"mopdepth/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/depth/stats/int_histogram.cr","line_number":3,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/int_histogram.cr#L3"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth/Stats","kind":"module","full_name":"Depth::Stats","name":"Stats"},"doc":"Histogram-based median for integers","summary":"<p>Histogram-based median for integers</p>","constructors":[{"html_id":"new(size:Int32=65536)-class-method","name":"new","abstract":false,"args":[{"name":"size","default_value":"65536","external_name":"size","restriction":"Int32"}],"args_string":"(size : Int32 = 65536)","args_html":"(size : Int32 = <span class=\"n\">65536</span>)","location":{"filename":"src/depth/stats/int_histogram.cr","line_number":10,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/int_histogram.cr#L10"},"def":{"name":"new","args":[{"name":"size","default_value":"65536","external_name":"size","restriction":"Int32"}],"visibility":"Public","body":"_ = allocate\n_.initialize(size)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"add(value:Int32)-instance-method","name":"add","abstract":false,"args":[{"name":"value","external_name":"value","restriction":"Int32"}],"args_string":"(value : Int32)","args_html":"(value : Int32)","location":{"filename":"src/depth/stats/int_histogram.cr","line_number":17,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/int_histogram.cr#L17"},"def":{"name":"add","args":[{"name":"value","external_name":"value","restriction":"Int32"}],"visibility":"Public","body":"@n = @n + 1\nv = value < 0 ? raise(ArgumentError.new(\"negative depth: #{value}\")) : value\nidx = v < counts.size ? v : counts.size - 1\nif @mark[idx]\nelse\n  @mark[idx] = true\n  @touched << idx\nend\n__temp_154 = idx\n__temp_155 = counts\n__temp_155[__temp_154] = __temp_155[__temp_154] + 1\n"},"external_var":false},{"html_id":"clear-instance-method","name":"clear","abstract":false,"location":{"filename":"src/depth/stats/int_histogram.cr","line_number":39,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/int_histogram.cr#L39"},"def":{"name":"clear","visibility":"Public","body":"if n == 0\n  return\nend\n@n = 0\n\n@touched.each do |i|\n  counts[i] = 0\n  @mark[i] = false\nend\n@touched.clear\n"},"external_var":false},{"html_id":"counts:Array(Int32)-instance-method","name":"counts","abstract":false,"location":{"filename":"src/depth/stats/int_histogram.cr","line_number":4,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/int_histogram.cr#L4"},"def":{"name":"counts","return_type":"Array(Int32)","visibility":"Public","body":"@counts"},"external_var":false},{"html_id":"median:Int32-instance-method","name":"median","abstract":false,"location":{"filename":"src/depth/stats/int_histogram.cr","line_number":28,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/int_histogram.cr#L28"},"def":{"name":"median","return_type":"Int32","visibility":"Public","body":"if n == 0\n  return 0\nend\nstop_n = ((n.to_f * 0.5) + 0.5).to_i\ncum = 0\ncounts.each_with_index do |cnt, i|\n  cum = cum + cnt\n  if cum >= stop_n\n    return i.to_i\n  end\nend\n0\n"},"external_var":false},{"html_id":"n:Int32-instance-method","name":"n","abstract":false,"location":{"filename":"src/depth/stats/int_histogram.cr","line_number":5,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/int_histogram.cr#L5"},"def":{"name":"n","return_type":"Int32","visibility":"Public","body":"@n"},"external_var":false}]},{"html_id":"mopdepth/Depth/Stats/Quantize","path":"Depth/Stats/Quantize.html","kind":"module","full_name":"Depth::Stats::Quantize","name":"Quantize","abstract":false,"locations":[{"filename":"src/depth/stats/quantize.cr","line_number":2,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/quantize.cr#L2"}],"repository_name":"mopdepth","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"mopdepth/Depth/Stats","kind":"module","full_name":"Depth::Stats","name":"Stats"},"class_methods":[{"html_id":"gen_quantized(quants:Array(Int32),coverage:Array(Int32),limit:Int32,&:Tuple(Int32,Int32,String)->)-class-method","name":"gen_quantized","doc":"Generate quantized depth segments\nlimit: number of elements from coverage to consider (typically target_size)\nYields tuples of (start, stop, label) over [0, limit-1]","summary":"<p>Generate quantized depth segments limit: number of elements from coverage to consider (typically target_size) Yields tuples of (start, stop, label) over [0, limit-1]</p>","abstract":false,"args":[{"name":"quants","external_name":"quants","restriction":"Array(Int32)"},{"name":"coverage","external_name":"coverage","restriction":"Array(Int32)"},{"name":"limit","external_name":"limit","restriction":"Int32"}],"args_string":"(quants : Array(Int32), coverage : Array(Int32), limit : Int32, & : Tuple(Int32, Int32, String) -> )","args_html":"(quants : Array(Int32), coverage : Array(Int32), limit : Int32, & : Tuple(Int32, Int32, String) -> )","location":{"filename":"src/depth/stats/quantize.cr","line_number":84,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/quantize.cr#L84"},"def":{"name":"gen_quantized","args":[{"name":"quants","external_name":"quants","restriction":"Array(Int32)"},{"name":"coverage","external_name":"coverage","restriction":"Array(Int32)"},{"name":"limit","external_name":"limit","restriction":"Int32"}],"yields":1,"block_arity":1,"block_arg":{"name":"","external_name":"","restriction":"(Tuple(Int32, Int32, String) ->)"},"visibility":"Public","body":"if quants.empty?\n  return\nend\nif coverage.empty?\n  return\nend\nif limit <= 1\n  return\nend\n\nlookup = make_lookup(quants)\nif lookup.empty?\n  return\nend\n\n\nlim = Math.min(limit, coverage.size)\n\nlast_quantized = linear_search(coverage[0], quants)\nlast_pos = 0\n\n(0...(lim - 1)).each do |pos|\n  depth = coverage[pos]\n  quantized = linear_search(depth, quants)\n\n  if quantized == last_quantized\n    next\n  end\n\n  if (last_quantized != -1) && last_quantized < lookup.size\n    yield({last_pos, pos, lookup[last_quantized]})\n  end\n\n  last_quantized = quantized\n  last_pos = pos\nend\n\n\nif ((last_quantized != -1) && last_pos < (lim - 1)) && last_quantized < lookup.size\n  yield({last_pos, lim - 1, lookup[last_quantized]})\nend\n"},"external_var":false},{"html_id":"gen_quantized(quants:Array(Int32),coverage:Array(Int32),&block:Tuple(Int32,Int32,String)->)-class-method","name":"gen_quantized","doc":"Backward-compatible overload: consume entire coverage array","summary":"<p>Backward-compatible overload: consume entire coverage array</p>","abstract":false,"args":[{"name":"quants","external_name":"quants","restriction":"Array(Int32)"},{"name":"coverage","external_name":"coverage","restriction":"Array(Int32)"}],"args_string":"(quants : Array(Int32), coverage : Array(Int32), &block : Tuple(Int32, Int32, String) -> )","args_html":"(quants : Array(Int32), coverage : Array(Int32), &block : Tuple(Int32, Int32, String) -> )","location":{"filename":"src/depth/stats/quantize.cr","line_number":119,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/quantize.cr#L119"},"def":{"name":"gen_quantized","args":[{"name":"quants","external_name":"quants","restriction":"Array(Int32)"},{"name":"coverage","external_name":"coverage","restriction":"Array(Int32)"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(Tuple(Int32, Int32, String) ->)"},"visibility":"Public","body":"gen_quantized(quants, coverage, coverage.size, &block)"},"external_var":false},{"html_id":"get_quantize_args(qa:String):Array(Int32)-class-method","name":"get_quantize_args","doc":"Parse quantize arguments string into array of integers\nExamples:\n  \":1\" -> [0, 1]\n  \"0:1:4:\" -> [0, 1, 4, Int32::MAX]","summary":"<p>Parse quantize arguments string into array of integers Examples:   &quot;:1&quot; -&gt; [0, 1]   &quot;0:1:4:&quot; -&gt; [0, 1, 4, Int32::MAX]</p>","abstract":false,"args":[{"name":"qa","external_name":"qa","restriction":"String"}],"args_string":"(qa : String) : Array(Int32)","args_html":"(qa : String) : Array(Int32)","location":{"filename":"src/depth/stats/quantize.cr","line_number":7,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/quantize.cr#L7"},"def":{"name":"get_quantize_args","args":[{"name":"qa","external_name":"qa","restriction":"String"}],"return_type":"Array(Int32)","visibility":"Public","body":"if (qa == \"nil\") || qa.empty?\n  return [] of Int32\nend\n\na = qa\n\n\nif (a.count(':')) == 0\n  a = (':' + a) + ':'\nend\n\n\nif a[0] == ':'\n  a = \"0\" + a\nend\n\n\nif a[-1] == ':'\n  a = a + Int32::MAX.to_s\nend\n\nbegin\n  qs = (a.split(':')).map(&.to_i)\n  qs.sort!\n  qs\nrescue ex\n  STDERR.puts(\"[mopdepth] invalid quantize string: '#{qa}'\")\n  exit(2)\nend\n"},"external_var":false},{"html_id":"linear_search(q:Int32,vals:Array(Int32)):Int32-class-method","name":"linear_search","doc":"Linear search to find which bin a value belongs to\nReturns -1 if value is outside all bins","summary":"<p>Linear search to find which bin a value belongs to Returns -1 if value is outside all bins</p>","abstract":false,"args":[{"name":"q","external_name":"q","restriction":"Int32"},{"name":"vals","external_name":"vals","restriction":"Array(Int32)"}],"args_string":"(q : Int32, vals : Array(Int32)) : Int32","args_html":"(q : Int32, vals : Array(Int32)) : Int32","location":{"filename":"src/depth/stats/quantize.cr","line_number":66,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/quantize.cr#L66"},"def":{"name":"linear_search","args":[{"name":"q","external_name":"q","restriction":"Int32"},{"name":"vals","external_name":"vals","restriction":"Array(Int32)"}],"return_type":"Int32","visibility":"Public","body":"if vals.empty?\n  return -1\nend\nif q < vals[0] || q > vals[-1]\n  return -1\nend\n\nvals.each_with_index do |val, i|\n  if val > q\n    return i - 1\n  elsif val == q\n    return i\n  end\nend\n\nvals.size - 1\n"},"external_var":false},{"html_id":"make_lookup(quants:Array(Int32)):Array(String)-class-method","name":"make_lookup","doc":"Create lookup table for quantize bins\nExamples:\n  [0, 1, 4] -> [\"0:1\", \"1:4\", \"4:inf\"]","summary":"<p>Create lookup table for quantize bins Examples:   [0, 1, 4] -&gt; [&quot;0:1&quot;, &quot;1:4&quot;, &quot;4:inf&quot;]</p>","abstract":false,"args":[{"name":"quants","external_name":"quants","restriction":"Array(Int32)"}],"args_string":"(quants : Array(Int32)) : Array(String)","args_html":"(quants : Array(Int32)) : Array(String)","location":{"filename":"src/depth/stats/quantize.cr","line_number":40,"url":"https://github.com/kojix2/mopdepth/blob/14a93a8885e0dd6a6ab0ccbe9fcc5f38102287b9/src/depth/stats/quantize.cr#L40"},"def":{"name":"make_lookup","args":[{"name":"quants","external_name":"quants","restriction":"Array(Int32)"}],"return_type":"Array(String)","visibility":"Public","body":"if quants.size <= 1\n  return [] of String\nend\n\nlookup = [] of String\n\n(0...(quants.size - 1)).each do |i|\n\n  env_var = \"MOSDEPTH_Q#{i}\"\n  custom_label = ENV[env_var]?\n\n  if custom_label\n    lookup << custom_label\n  elsif quants[i + 1] == Int32::MAX\n    lookup << \"#{quants[i]}:inf\"\n  else\n    lookup << \"#{quants[i]}:#{quants[i + 1]}\"\n  end\nend\n\nlookup\n"},"external_var":false}]}]}]}]}}