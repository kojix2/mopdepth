<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Crystal Docs 1.16.3">
<meta name="crystal_docs.project_version" content="main">
<meta name="crystal_docs.project_name" content="mopdepth">



<link href="css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/doc.js"></script>

  <meta name="repository-name" content="mopdepth">
  <title>mopdepth main</title>
  <script type="text/javascript">
  CrystalDocs.base_path = "";
  </script>
</head>
<body>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill="currentColor" fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>
<input type="checkbox" id="sidebar-btn">
<label for="sidebar-btn" id="sidebar-btn-label">
  <svg class="open" xmlns="http://www.w3.org/2000/svg" height="2em" width="2em" viewBox="0 0 512 512"><title>Open Sidebar</title><path fill="currentColor" d="M80 96v64h352V96H80zm0 112v64h352v-64H80zm0 112v64h352v-64H80z"></path></svg>
  <svg class="close" xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 512 512"><title>Close Sidebar</title><path fill="currentColor" d="m118.6 73.4-45.2 45.2L210.7 256 73.4 393.4l45.2 45.2L256 301.3l137.4 137.3 45.2-45.2L301.3 256l137.3-137.4-45.2-45.2L256 210.7Z"></path></svg>
</label>
<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="index.html">
          mopdepth
        </a>
      </h1>

      <span class="project-version">
        main
      </span>
    </div>
  </div>

  <div class="search-results hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent " data-id="mopdepth/Depth" data-name="depth">
      <a href="Depth.html">Depth</a>
      
        <ul>
  
  <li class=" " data-id="mopdepth/Depth/BamIndexError" data-name="depth::bamindexerror">
      <a href="Depth/BamIndexError.html">BamIndexError</a>
      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/CLI" data-name="depth::cli">
      <a href="Depth/CLI.html">CLI</a>
      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/Config" data-name="depth::config">
      <a href="Depth/Config.html">Config</a>
      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/ConfigError" data-name="depth::configerror">
      <a href="Depth/ConfigError.html">ConfigError</a>
      
    </li>
  
  <li class="parent " data-id="mopdepth/Depth/Core" data-name="depth::core">
      <a href="Depth/Core.html">Core</a>
      
        <ul>
  
  <li class=" " data-id="mopdepth/Depth/Core/Cigar" data-name="depth::core::cigar">
      <a href="Depth/Core/Cigar.html">Cigar</a>
      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/Core/Coverage" data-name="depth::core::coverage">
      <a href="Depth/Core/Coverage.html">Coverage</a>
      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/Core/CoverageCalculator" data-name="depth::core::coveragecalculator">
      <a href="Depth/Core/CoverageCalculator.html">CoverageCalculator</a>
      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/Core/CoverageResult" data-name="depth::core::coverageresult">
      <a href="Depth/Core/CoverageResult.html">CoverageResult</a>
      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/Core/CoverageUtils" data-name="depth::core::coverageutils">
      <a href="Depth/Core/CoverageUtils.html">CoverageUtils</a>
      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/Core/Options" data-name="depth::core::options">
      <a href="Depth/Core/Options.html">Options</a>
      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/Core/Region" data-name="depth::core::region">
      <a href="Depth/Core/Region.html">Region</a>
      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/Core/Target" data-name="depth::core::target">
      <a href="Depth/Core/Target.html">Target</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/CoverageCalculationError" data-name="depth::coveragecalculationerror">
      <a href="Depth/CoverageCalculationError.html">CoverageCalculationError</a>
      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/Error" data-name="depth::error">
      <a href="Depth/Error.html">Error</a>
      
    </li>
  
  <li class="parent " data-id="mopdepth/Depth/FileIO" data-name="depth::fileio">
      <a href="Depth/FileIO.html">FileIO</a>
      
        <ul>
  
  <li class=" " data-id="mopdepth/Depth/FileIO/OutputManager" data-name="depth::fileio::outputmanager">
      <a href="Depth/FileIO/OutputManager.html">OutputManager</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/FileNotFoundError" data-name="depth::filenotfounderror">
      <a href="Depth/FileNotFoundError.html">FileNotFoundError</a>
      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/InvalidRegionError" data-name="depth::invalidregionerror">
      <a href="Depth/InvalidRegionError.html">InvalidRegionError</a>
      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/Runner" data-name="depth::runner">
      <a href="Depth/Runner.html">Runner</a>
      
    </li>
  
  <li class="parent " data-id="mopdepth/Depth/Stats" data-name="depth::stats">
      <a href="Depth/Stats.html">Stats</a>
      
        <ul>
  
  <li class=" " data-id="mopdepth/Depth/Stats/DepthStat" data-name="depth::stats::depthstat">
      <a href="Depth/Stats/DepthStat.html">DepthStat</a>
      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/Stats/Distribution" data-name="depth::stats::distribution">
      <a href="Depth/Stats/Distribution.html">Distribution</a>
      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/Stats/IntHistogram" data-name="depth::stats::inthistogram">
      <a href="Depth/Stats/IntHistogram.html">IntHistogram</a>
      
    </li>
  
  <li class=" " data-id="mopdepth/Depth/Stats/Quantize" data-name="depth::stats::quantize">
      <a href="Depth/Stats/Quantize.html">Quantize</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1><a id="mopdepth" class="anchor" href="#mopdepth">  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>mopdepth</h1>
<p><a href="https://github.com/kojix2/mopdepth/actions/workflows/build.yml"><img src="https://github.com/kojix2/mopdepth/actions/workflows/build.yml/badge.svg" alt="build" /></a>
<a href="https://tokei.kojix2.net/github/kojix2/mopdepth"><img src="https://img.shields.io/endpoint?url=https://tokei.kojix2.net/badge/github/kojix2/mopdepth/lines" alt="Lines of Code" /></a>
<img src="https://img.shields.io/badge/PURE-VIBE_CODING-magenta" alt="Static Badge" /></p>
<p>A fast BAM/CRAM depth calculation tool written in Crystal, inspired by <a href="https://github.com/brentp/mosdepth">mosdepth</a>.</p>
<p><strong>This is an experiment to see if well-known tools can be ported to Crystal using “vibe coding”.</strong></p>
<h2><a id="features" class="anchor" href="#features">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Features</h2>
<ul>
<li>Fast depth calculation for BAM/CRAM files</li>
<li>Multiple processing modes (fast mode, fragment mode, CIGAR-based)</li>
<li>Per-base and region-based depth analysis</li>
<li>BED file support for custom regions</li>
<li>Window-based analysis</li>
<li>Comprehensive filtering options (MAPQ, fragment length, flags)</li>
</ul>
<h2><a id="installation" class="anchor" href="#installation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Installation</h2>
<h3><a id="prerequisites" class="anchor" href="#prerequisites">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Prerequisites</h3>
<ul>
<li>Crystal</li>
<li>hts-lib (for BAM/CRAM support)</li>
</ul>
<h3><a id="build-from-source" class="anchor" href="#build-from-source">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Build from source</h3>
<pre><code class="language-bash">git clone https://github.com/kojix2/mopdepth
cd mopdepth
shards install
shares build --release</code></pre>
<h2><a id="usage" class="anchor" href="#usage">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Usage</h2>
<pre><code class="language-bash">./mopdepth [options] &lt;prefix&gt; &lt;BAM-or-CRAM&gt;</code></pre>
<h3><a id="basic-example" class="anchor" href="#basic-example">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Basic example</h3>
<pre><code class="language-bash">./mopdepth output sample.bam</code></pre>
<h3><a id="options" class="anchor" href="#options">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Options</h3>
<ul>
<li><code>-t, --threads THREADS</code>: BAM decompression threads</li>
<li><code>-c, --chrom CHROM</code>: Restrict to chromosome</li>
<li><code>-b, --by BY</code>: BED file or numeric window size</li>
<li><code>-n, --no-per-base</code>: Skip per-base output</li>
<li><code>-Q, --mapq MAPQ</code>: MAPQ threshold</li>
<li><code>-l, --min-frag-len MIN</code>: Minimum fragment length</li>
<li><code>-u, --max-frag-len MAX</code>: Maximum fragment length</li>
<li><code>-x, --fast-mode</code>: Fast mode (read start/end positions only)</li>
<li><code>-a, --fragment-mode</code>: Count full fragment (proper pairs only)</li>
<li><code>-m, --use-median</code>: Use median for region stats instead of mean</li>
<li><code>-M, --mos</code>: Use mosdepth-compatible filenames (mosdepth.<em>); default is depth.</em></li>
<li><code>-v, --version</code>: Show version</li>
<li><code>-h, --help</code>: Show help message</li>
</ul>
<h3><a id="processing-modes" class="anchor" href="#processing-modes">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Processing modes</h3>
<ul>
<li><strong>Default mode</strong>: CIGAR-based depth calculation (most accurate)</li>
<li><strong>Fast mode</strong> (<code>-x</code>): Uses read start/end positions (faster but less accurate)</li>
<li><strong>Fragment mode</strong> (<code>-a</code>): Counts full fragments for paired-end reads</li>
</ul>
<p><strong>Note</strong>: Fast mode and fragment mode cannot be used together.</p>
<h3><a id="output-files" class="anchor" href="#output-files">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Output files</h3>
<ul>
<li>Summary: <code>&lt;prefix&gt;.(mopdepth|mosdepth).summary.txt</code></li>
<li>Per-base: <code>&lt;prefix&gt;.per-base.bed</code> (unless <code>-n</code>)</li>
<li>Global dist: <code>&lt;prefix&gt;.(mopdepth|mosdepth).global.dist.txt</code></li>
<li>Regions: <code>&lt;prefix&gt;.regions.bed</code> (when <code>--by</code>)</li>
<li>Region dist: <code>&lt;prefix&gt;.(mopdepth|mosdepth).region.dist.txt</code> (when <code>--by</code>)</li>
</ul>
<p>By default, files are named with the <code>mopdepth.*</code> label. Use <code>-M/--mos</code> to switch to <code>mosdepth.*</code>.</p>
<h3><a id="summary-file-format" class="anchor" href="#summary-file-format">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Summary file format</h3>
<p>The summary file contains the following columns:</p>
<ul>
<li><code>chrom</code>: Chromosome name</li>
<li><code>length</code>: Chromosome length</li>
<li><code>sum_depth</code>: Total depth (sum of all depths)</li>
<li><code>mean</code>: Mean depth</li>
<li><code>min</code>: Minimum depth</li>
<li><code>max</code>: Maximum depth</li>
</ul>
<h2><a id="examples" class="anchor" href="#examples">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Examples</h2>
<h3><a id="basic-depth-calculation" class="anchor" href="#basic-depth-calculation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Basic depth calculation</h3>
<pre><code class="language-bash">./mopdepth output sample.bam</code></pre>
<h3><a id="with-bed-regions" class="anchor" href="#with-bed-regions">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>With BED regions</h3>
<pre><code class="language-bash">./mopdepth -b regions.bed output sample.bam</code></pre>
<h3><a id="window-based-analysis-1kb-windows" class="anchor" href="#window-based-analysis-1kb-windows">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Window-based analysis (1kb windows)</h3>
<pre><code class="language-bash">./mopdepth -b 1000 output sample.bam</code></pre>
<h3><a id="fast-mode-with-mapq-filtering" class="anchor" href="#fast-mode-with-mapq-filtering">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Fast mode with MAPQ filtering</h3>
<pre><code class="language-bash">./mopdepth -x -Q 20 output sample.bam</code></pre>
<h3><a id="fragment-mode-for-paired-end-data" class="anchor" href="#fragment-mode-for-paired-end-data">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Fragment mode for paired-end data</h3>
<pre><code class="language-bash">./mopdepth -a -l 100 -u 1000 output sample.bam</code></pre>
<h2><a id="license" class="anchor" href="#license">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>License</h2>
<p>MIT License</p>
</div>
</body>
</html>
